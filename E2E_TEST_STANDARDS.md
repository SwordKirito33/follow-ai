# E2E æµ‹è¯•æ ‡å‡†å’Œæ¡ä»¶ï¼ˆP2-13ï¼‰

**åˆ¶å®šæ—¥æœŸï¼š** 2024-01-05  
**æµ‹è¯•æ¡†æ¶ï¼š** Playwright  
**è¦†ç›–ç‡ç›®æ ‡ï¼š** 80%+

---

## ğŸ“‹ æµ‹è¯•æ ‡å‡†

### 1. æµ‹è¯•èŒƒå›´å®šä¹‰

#### A. å…³é”®ç”¨æˆ·æµç¨‹ï¼ˆCritical User Flowsï¼‰
| æµç¨‹ | ä¼˜å…ˆçº§ | è¦†ç›–ç‡ç›®æ ‡ | é¢„æœŸæ—¶é—´ |
|------|--------|----------|---------|
| ç”¨æˆ·è®¤è¯ | P0 | 100% | 30min |
| ä»»åŠ¡åˆ›å»ºå’Œæäº¤ | P0 | 100% | 45min |
| ä»»åŠ¡å®¡æ ¸å’Œå¥–åŠ± | P0 | 100% | 45min |
| ç”¨æˆ·ä¸ªäººèµ„æ–™ | P1 | 90% | 30min |
| æ’è¡Œæ¦œå’Œæ’å | P1 | 85% | 30min |
| æ”¯ä»˜å’Œæç° | P0 | 100% | 45min |

#### B. åŠŸèƒ½æ¨¡å—ï¼ˆFeature Modulesï¼‰
| æ¨¡å— | æµ‹è¯•é¡¹ | è¦†ç›–ç‡ |
|------|--------|--------|
| è®¤è¯ç³»ç»Ÿ | ç™»å½•ã€æ³¨å†Œã€é‡ç½®å¯†ç  | 100% |
| ä»»åŠ¡ç®¡ç† | åˆ›å»ºã€ç¼–è¾‘ã€åˆ é™¤ã€æäº¤ | 95% |
| å®¡æ ¸ç³»ç»Ÿ | å®¡æ ¸ã€æ‰¹å‡†ã€æ‹’ç»ã€è¯„è®º | 90% |
| XP ç³»ç»Ÿ | XP è®¡ç®—ã€å¥–åŠ±ã€å†å² | 100% |
| æ”¯ä»˜ç³»ç»Ÿ | æ”¯ä»˜ã€æç°ã€äº¤æ˜“å†å² | 100% |
| é€šçŸ¥ç³»ç»Ÿ | å‘é€ã€æ¥æ”¶ã€æ ‡è®°å·²è¯» | 85% |
| ç”¨æˆ·ç®¡ç† | ä¸ªäººèµ„æ–™ã€è®¾ç½®ã€åå¥½ | 80% |

#### C. é”™è¯¯å¤„ç†ï¼ˆError Handlingï¼‰
| é”™è¯¯ç±»å‹ | æµ‹è¯•é¡¹ | è¦†ç›–ç‡ |
|---------|--------|--------|
| ç½‘ç»œé”™è¯¯ | è¶…æ—¶ã€è¿æ¥å¤±è´¥ã€é‡è¯• | 90% |
| éªŒè¯é”™è¯¯ | æ— æ•ˆè¾“å…¥ã€ç¼ºå°‘å­—æ®µ | 95% |
| ä¸šåŠ¡é€»è¾‘é”™è¯¯ | ä½™é¢ä¸è¶³ã€æƒé™ä¸è¶³ | 90% |
| æœåŠ¡å™¨é”™è¯¯ | 500ã€503ã€è¶…æ—¶ | 85% |

### 2. æµ‹è¯•è´¨é‡æ ‡å‡†

#### ä»£ç è´¨é‡
- âœ… æ‰€æœ‰æµ‹è¯•éƒ½æœ‰æ¸…æ™°çš„æè¿°
- âœ… æµ‹è¯•æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¾èµ–æ‰§è¡Œé¡ºåº
- âœ… ä½¿ç”¨ Page Object Model (POM) è®¾è®¡æ¨¡å¼
- âœ… æµ‹è¯•æ•°æ®ç‹¬ç«‹ï¼Œä½¿ç”¨ fixtures
- âœ… é¿å…ç¡¬ç­‰å¾…ï¼Œä½¿ç”¨æ˜¾å¼ç­‰å¾…

#### æµ‹è¯•è¦†ç›–ç‡
- **ç›®æ ‡ï¼š** 80%+
- **å…³é”®æµç¨‹ï¼š** 100%
- **åŠŸèƒ½æ¨¡å—ï¼š** 90%+
- **é”™è¯¯å¤„ç†ï¼š** 85%+

#### æ€§èƒ½æ ‡å‡†
- **å•ä¸ªæµ‹è¯•æ—¶é—´ï¼š** < 30 ç§’
- **å®Œæ•´æµ‹è¯•å¥—ä»¶ï¼š** < 10 åˆ†é’Ÿ
- **å¹¶è¡Œæ‰§è¡Œï¼š** 4-8 ä¸ªå·¥ä½œè¿›ç¨‹

### 3. æµ‹è¯•ç¯å¢ƒæ ‡å‡†

#### æµè§ˆå™¨è¦†ç›–
- âœ… Chrome/Chromiumï¼ˆæœ€æ–°ï¼‰
- âœ… Firefoxï¼ˆæœ€æ–°ï¼‰
- âœ… Safariï¼ˆæœ€æ–°ï¼‰
- âœ… Edgeï¼ˆæœ€æ–°ï¼‰

#### è®¾å¤‡è¦†ç›–
- âœ… æ¡Œé¢ï¼ˆ1920x1080ï¼‰
- âœ… å¹³æ¿ï¼ˆ768x1024ï¼‰
- âœ… æ‰‹æœºï¼ˆ375x667ï¼‰

#### ç½‘ç»œæ¡ä»¶
- âœ… å¿«é€Ÿç½‘ç»œï¼ˆ4Gï¼‰
- âœ… æ­£å¸¸ç½‘ç»œï¼ˆ3Gï¼‰
- âœ… æ…¢é€Ÿç½‘ç»œï¼ˆ2Gï¼‰

---

## ğŸ¯ æµ‹è¯•æ¡ä»¶

### 1. å‰ç½®æ¡ä»¶ï¼ˆSetupï¼‰

#### ç¯å¢ƒå‡†å¤‡
```javascript
// æ¯ä¸ªæµ‹è¯•å‰æ‰§è¡Œ
beforeEach(async ({ page }) => {
  // 1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œ cookies
  await page.context().clearCookies();
  
  // 2. é‡ç½®æ•°æ®åº“çŠ¶æ€
  await resetTestDatabase();
  
  // 3. åˆ›å»ºæµ‹è¯•ç”¨æˆ·
  await createTestUser({
    email: 'test@example.com',
    password: 'Test123!@#',
    role: 'user'
  });
  
  // 4. å¯¼èˆªåˆ°åº”ç”¨
  await page.goto('http://localhost:5173');
});
```

#### æµ‹è¯•æ•°æ®
```javascript
// æ ‡å‡†æµ‹è¯•æ•°æ®
const testData = {
  users: {
    admin: {
      email: 'admin@test.com',
      password: 'Admin123!@#',
      role: 'admin'
    },
    reviewer: {
      email: 'reviewer@test.com',
      password: 'Reviewer123!@#',
      role: 'reviewer'
    },
    user: {
      email: 'user@test.com',
      password: 'User123!@#',
      role: 'user'
    }
  },
  tasks: {
    simple: {
      title: 'Simple Task',
      description: 'A simple test task',
      reward: 100,
      difficulty: 'easy'
    },
    complex: {
      title: 'Complex Task',
      description: 'A complex test task',
      reward: 500,
      difficulty: 'hard'
    }
  }
};
```

### 2. æ‰§è¡Œæ¡ä»¶ï¼ˆExecutionï¼‰

#### æµ‹è¯•éš”ç¦»
- âœ… æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œ
- âœ… ä¸å…±äº«çŠ¶æ€
- âœ… æ¸…ç†èµ„æº
- âœ… æ¢å¤åˆå§‹çŠ¶æ€

#### å¹¶å‘æ§åˆ¶
```javascript
// playwright.config.ts
export default defineConfig({
  workers: 4, // 4 ä¸ªå¹¶è¡Œå·¥ä½œè¿›ç¨‹
  timeout: 30000, // å•ä¸ªæµ‹è¯•è¶…æ—¶ 30 ç§’
  expect: {
    timeout: 5000 // æ–­è¨€è¶…æ—¶ 5 ç§’
  }
});
```

#### é‡è¯•ç­–ç•¥
```javascript
// å¤±è´¥é‡è¯•
export default defineConfig({
  retries: 2, // å¤±è´¥é‡è¯• 2 æ¬¡
  fullyParallel: false, // é¡ºåºæ‰§è¡Œé‡è¯•
});
```

### 3. éªŒè¯æ¡ä»¶ï¼ˆAssertionsï¼‰

#### åŠŸèƒ½éªŒè¯
- âœ… é¡µé¢åŠ è½½æˆåŠŸ
- âœ… å…ƒç´ å¯è§å’Œå¯äº¤äº’
- âœ… è¡¨å•æäº¤æˆåŠŸ
- âœ… æ•°æ®æ­£ç¡®ä¿å­˜
- âœ… å¯¼èˆªæ­£ç¡®

#### æ€§èƒ½éªŒè¯
- âœ… é¡µé¢åŠ è½½æ—¶é—´ < 3s
- âœ… äº¤äº’å“åº”æ—¶é—´ < 1s
- âœ… API å“åº”æ—¶é—´ < 2s

#### å®‰å…¨éªŒè¯
- âœ… è®¤è¯ä»¤ç‰Œæ­£ç¡®
- âœ… æƒé™æ£€æŸ¥é€šè¿‡
- âœ… XSS é˜²æŠ¤æœ‰æ•ˆ
- âœ… CSRF é˜²æŠ¤æœ‰æ•ˆ

### 4. æ¸…ç†æ¡ä»¶ï¼ˆTeardownï¼‰

```javascript
// æ¯ä¸ªæµ‹è¯•åæ‰§è¡Œ
afterEach(async ({ page }) => {
  // 1. æ¸…é™¤ localStorage å’Œ sessionStorage
  await page.evaluate(() => {
    localStorage.clear();
    sessionStorage.clear();
  });
  
  // 2. å…³é—­æ‰€æœ‰æ ‡ç­¾é¡µ
  const pages = page.context().pages();
  for (const p of pages) {
    await p.close();
  }
  
  // 3. æ¸…ç†æµ‹è¯•æ•°æ®
  await cleanupTestDatabase();
});
```

---

## ğŸ“Š æµ‹è¯•çŸ©é˜µ

### æµè§ˆå™¨ Ã— è®¾å¤‡ Ã— ç½‘ç»œ

```
æµè§ˆå™¨: Chrome, Firefox, Safari, Edge (4)
è®¾å¤‡: æ¡Œé¢, å¹³æ¿, æ‰‹æœº (3)
ç½‘ç»œ: å¿«é€Ÿ, æ­£å¸¸, æ…¢é€Ÿ (3)

æ€»ç»„åˆæ•°: 4 Ã— 3 Ã— 3 = 36 ç§
```

### ä¼˜å…ˆçº§æµ‹è¯•çŸ©é˜µ

| ä¼˜å…ˆçº§ | æµè§ˆå™¨ | è®¾å¤‡ | ç½‘ç»œ | é¢‘ç‡ |
|--------|--------|------|------|------|
| P0 | æ‰€æœ‰ | æ‰€æœ‰ | æ‰€æœ‰ | æ¯æ¬¡æäº¤ |
| P1 | Chrome, Firefox | æ¡Œé¢, æ‰‹æœº | å¿«é€Ÿ, æ­£å¸¸ | æ¯å¤© |
| P2 | Chrome | æ¡Œé¢ | å¿«é€Ÿ | æ¯å‘¨ |

---

## ğŸ” æµ‹è¯•ç”¨ä¾‹æ ‡å‡†

### ç”¨ä¾‹ç»“æ„

```javascript
test('should [action] when [condition] and [precondition]', async ({ page }) => {
  // 1. Setup - å‡†å¤‡æµ‹è¯•ç¯å¢ƒ
  await setupTestData();
  
  // 2. Action - æ‰§è¡Œç”¨æˆ·æ“ä½œ
  await page.goto('/tasks');
  await page.click('button:has-text("Create Task")');
  await page.fill('input[name="title"]', 'Test Task');
  
  // 3. Assert - éªŒè¯ç»“æœ
  await expect(page.locator('text=Task created')).toBeVisible();
  
  // 4. Cleanup - æ¸…ç†èµ„æº
  await cleanupTestData();
});
```

### ç”¨ä¾‹å‘½åè§„èŒƒ

```
âœ… Good:
- should_login_successfully_with_valid_credentials
- should_show_error_when_password_is_incorrect
- should_create_task_and_receive_xp_reward

âŒ Bad:
- test_login
- test_error
- test_task
```

### ç”¨ä¾‹ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | æ¡ä»¶ | ç¤ºä¾‹ |
|--------|------|------|
| P0 | å…³é”®ä¸šåŠ¡æµç¨‹ | ç™»å½•ã€æ”¯ä»˜ã€XP å¥–åŠ± |
| P1 | é‡è¦åŠŸèƒ½ | ä»»åŠ¡åˆ›å»ºã€ä¸ªäººèµ„æ–™ |
| P2 | è¾…åŠ©åŠŸèƒ½ | é€šçŸ¥ã€åå¥½è®¾ç½® |
| P3 | è¾¹ç•Œæƒ…å†µ | ç‰¹æ®Šå­—ç¬¦ã€æé™å€¼ |

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

### æµ‹è¯•ç¼–å†™å‰
- [ ] ç†è§£éœ€æ±‚å’Œç”¨æˆ·æµç¨‹
- [ ] ç¡®å®šæµ‹è¯•èŒƒå›´å’Œä¼˜å…ˆçº§
- [ ] å‡†å¤‡æµ‹è¯•æ•°æ®
- [ ] è®¾è®¡ Page Object
- [ ] è®¡åˆ’æµ‹è¯•ç”¨ä¾‹

### æµ‹è¯•ç¼–å†™ä¸­
- [ ] éµå¾ªå‘½åè§„èŒƒ
- [ ] ä½¿ç”¨ POM è®¾è®¡æ¨¡å¼
- [ ] æ·»åŠ æ¸…æ™°çš„æ³¨é‡Š
- [ ] é¿å…ç¡¬ç­‰å¾…
- [ ] ä½¿ç”¨æ˜¾å¼ç­‰å¾…

### æµ‹è¯•æ‰§è¡Œå‰
- [ ] æ‰€æœ‰æµ‹è¯•éƒ½èƒ½ç‹¬ç«‹è¿è¡Œ
- [ ] æµ‹è¯•æ•°æ®æ­£ç¡®å‡†å¤‡
- [ ] ç¯å¢ƒé…ç½®æ­£ç¡®
- [ ] ä¾èµ–é¡¹å·²å®‰è£…

### æµ‹è¯•æ‰§è¡Œä¸­
- [ ] ç›‘æ§æµ‹è¯•è¿›åº¦
- [ ] è®°å½•å¤±è´¥åŸå› 
- [ ] æ”¶é›†è¦†ç›–ç‡æ•°æ®
- [ ] æ€§èƒ½ç›‘æ§

### æµ‹è¯•æ‰§è¡Œå
- [ ] åˆ†ææµ‹è¯•ç»“æœ
- [ ] ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- [ ] ä¿®å¤å¤±è´¥çš„æµ‹è¯•
- [ ] ä¼˜åŒ–æµ‹è¯•æ€§èƒ½

---

## ğŸ“ˆ æµ‹è¯•æŒ‡æ ‡

### è¦†ç›–ç‡æŒ‡æ ‡
- **è¯­å¥è¦†ç›–ç‡ï¼š** 80%+
- **åˆ†æ”¯è¦†ç›–ç‡ï¼š** 75%+
- **å‡½æ•°è¦†ç›–ç‡ï¼š** 85%+
- **è¡Œè¦†ç›–ç‡ï¼š** 80%+

### è´¨é‡æŒ‡æ ‡
- **æµ‹è¯•é€šè¿‡ç‡ï¼š** 95%+
- **ç¼ºé™·æ£€å‡ºç‡ï¼š** 90%+
- **æµ‹è¯•æ‰§è¡Œæ—¶é—´ï¼š** < 10 åˆ†é’Ÿ
- **æµ‹è¯•ç»´æŠ¤æˆæœ¬ï¼š** ä½

### æ€§èƒ½æŒ‡æ ‡
- **å¹³å‡æµ‹è¯•æ—¶é—´ï¼š** 15 ç§’
- **æœ€å¤§æµ‹è¯•æ—¶é—´ï¼š** 30 ç§’
- **å¹¶è¡Œæ•ˆç‡ï¼š** 80%+
- **èµ„æºå ç”¨ï¼š** < 2GB

---

## ğŸš€ æµ‹è¯•æ‰§è¡Œè®¡åˆ’

### Week 1: åŸºç¡€æµ‹è¯•ï¼ˆP0ï¼‰
- [ ] è®¤è¯ç³»ç»Ÿæµ‹è¯•
- [ ] ä»»åŠ¡ç®¡ç†æµ‹è¯•
- [ ] æ”¯ä»˜ç³»ç»Ÿæµ‹è¯•
- [ ] XP ç³»ç»Ÿæµ‹è¯•

### Week 2: åŠŸèƒ½æµ‹è¯•ï¼ˆP1ï¼‰
- [ ] å®¡æ ¸ç³»ç»Ÿæµ‹è¯•
- [ ] ç”¨æˆ·ç®¡ç†æµ‹è¯•
- [ ] æ’è¡Œæ¦œæµ‹è¯•
- [ ] é€šçŸ¥ç³»ç»Ÿæµ‹è¯•

### Week 3: é›†æˆæµ‹è¯•ï¼ˆP2ï¼‰
- [ ] è·¨æ¨¡å—é›†æˆ
- [ ] é”™è¯¯å¤„ç†
- [ ] è¾¹ç•Œæƒ…å†µ
- [ ] æ€§èƒ½æµ‹è¯•

### Week 4: æŒç»­é›†æˆ
- [ ] CI/CD é›†æˆ
- [ ] è‡ªåŠ¨åŒ–æ‰§è¡Œ
- [ ] è¦†ç›–ç‡æŠ¥å‘Š
- [ ] æ€§èƒ½åŸºå‡†

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
# E2E æµ‹è¯•æŠ¥å‘Š

**æ‰§è¡Œæ—¥æœŸï¼š** 2024-01-XX
**æ‰§è¡Œç¯å¢ƒï¼š** Chrome 120, Firefox 121, Safari 17, Edge 120
**æµ‹è¯•æ•°é‡ï¼š** 150
**é€šè¿‡æ•°ï¼š** 145
**å¤±è´¥æ•°ï¼š** 5
**è·³è¿‡æ•°ï¼š** 0

## è¦†ç›–ç‡
- è¯­å¥è¦†ç›–ç‡ï¼š82%
- åˆ†æ”¯è¦†ç›–ç‡ï¼š78%
- å‡½æ•°è¦†ç›–ç‡ï¼š85%
- è¡Œè¦†ç›–ç‡ï¼š81%

## å¤±è´¥ç”¨ä¾‹
1. [P1] should_handle_network_timeout - Firefox
2. [P2] should_validate_special_characters - Safari
...

## æ€§èƒ½æŒ‡æ ‡
- å¹³å‡æµ‹è¯•æ—¶é—´ï¼š14.5s
- æœ€å¤§æµ‹è¯•æ—¶é—´ï¼š28.3s
- æ€»æ‰§è¡Œæ—¶é—´ï¼š9åˆ†é’Ÿ

## å»ºè®®
- ä¼˜åŒ–ç½‘ç»œè¶…æ—¶å¤„ç†
- æ”¹è¿› Safari å…¼å®¹æ€§
- å¢åŠ è¾¹ç•Œæƒ…å†µæµ‹è¯•
```

---

## æ€»ç»“

**æµ‹è¯•æ ‡å‡†ï¼š**
- âœ… è¦†ç›–ç‡ 80%+
- âœ… é€šè¿‡ç‡ 95%+
- âœ… æ‰§è¡Œæ—¶é—´ < 10 åˆ†é’Ÿ

**æµ‹è¯•æ¡ä»¶ï¼š**
- âœ… å¤šæµè§ˆå™¨æ”¯æŒ
- âœ… å¤šè®¾å¤‡è¦†ç›–
- âœ… å¤šç½‘ç»œæ¡ä»¶
- âœ… å®Œæ•´çš„ setup/teardown

**ä¸‹ä¸€æ­¥ï¼š** å®ç° E2E æµ‹è¯•æ¡†æ¶å’Œç¼–å†™æµ‹è¯•ç”¨ä¾‹
