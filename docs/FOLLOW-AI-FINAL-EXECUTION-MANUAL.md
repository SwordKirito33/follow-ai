# Follow.ai æœ€ç»ˆæ‰§è¡Œæ‰‹å†Œï¼ˆèåˆç‰ˆï¼‰

**ç‰ˆæœ¬**: 2.0  
**æ—¥æœŸ**: 2026å¹´1æœˆ8æ—¥  
**æ¥æº**: Manus + Claude æ–¹æ¡ˆèåˆ  
**æ‰§è¡Œæ¨¡å¼**: é€æ­¥é€’å¢ï¼Œæ¯æ­¥å¯éªŒè¯

---

## ğŸ“‹ ç›®å½•

1. [æ‰§è¡Œæ¦‚è§ˆ](#ä¸€æ‰§è¡Œæ¦‚è§ˆ)
2. [Phase 0: åŸºç¡€è®¾æ–½å‡†å¤‡](#äºŒphase-0-åŸºç¡€è®¾æ–½å‡†å¤‡)
3. [Phase 1: P0 Bug ä¿®å¤](#ä¸‰phase-1-p0-bug-ä¿®å¤)
4. [Phase 2: ç›‘æ§ä½“ç³»](#å››phase-2-ç›‘æ§ä½“ç³»)
5. [Phase 3: æ€§èƒ½ä¼˜åŒ–](#äº”phase-3-æ€§èƒ½ä¼˜åŒ–)
6. [Phase 4: Admin + AI Review](#å…­phase-4-admin--ai-review)
7. [Phase 5: æ¸¸æˆåŒ–ç³»ç»Ÿ](#ä¸ƒphase-5-æ¸¸æˆåŒ–ç³»ç»Ÿ)
8. [Phase 6: SEO + å¯è®¿é—®æ€§](#å…«phase-6-seo--å¯è®¿é—®æ€§)
9. [Phase 7: æµ‹è¯•å®Œå–„](#ä¹phase-7-æµ‹è¯•å®Œå–„)
10. [éªŒè¯æ¸…å•](#åéªŒè¯æ¸…å•)
11. [é™„å½•](#åä¸€é™„å½•)

---

## ä¸€ã€æ‰§è¡Œæ¦‚è§ˆ

### 1.1 ä¿®å¤é€»è¾‘ä¾èµ–å›¾

```
Phase 0: åŸºç¡€è®¾æ–½å‡†å¤‡ (å¿…é¡»æœ€å…ˆ)
    â”‚
    â”œâ”€â”€ Git åˆ†æ”¯ç­–ç•¥
    â”œâ”€â”€ ä¾èµ–å®‰è£…
    â””â”€â”€ TypeScript é…ç½®
    â”‚
    â†“
Phase 1: P0 Bug ä¿®å¤ (é˜»å¡æ€§é—®é¢˜)
    â”‚
    â”œâ”€â”€ ç™»å‡ºæµç¨‹ (å« React Query æ¸…ç†)
    â”œâ”€â”€ é€šçŸ¥é¢æ¿ (useOptimistic)
    â””â”€â”€ è¡¨å•éªŒè¯ (Zod + RHF)
    â”‚
    â†“
Phase 2: ç›‘æ§ä½“ç³» (å¯è§‚æµ‹æ€§åŸºç¡€)
    â”‚
    â”œâ”€â”€ Sentry é”™è¯¯ç›‘æ§
    â”œâ”€â”€ PostHog äº§å“åˆ†æ
    â””â”€â”€ Web Vitals æ€§èƒ½ç›‘æ§
    â”‚
    â†“
Phase 3: æ€§èƒ½ä¼˜åŒ– (ç”¨æˆ·ä½“éªŒæå‡)
    â”‚
    â”œâ”€â”€ ä»£ç åˆ†å‰²
    â”œâ”€â”€ è·¯ç”±æ‡’åŠ è½½
    â””â”€â”€ å›¾ç‰‡ä¼˜åŒ–
    â”‚
    â†“
Phase 4: Admin + AI Review (è¿è¥èƒ½åŠ›)
    â”‚
    â”œâ”€â”€ ç®¡ç†å‘˜è§’è‰²ç³»ç»Ÿ
    â”œâ”€â”€ Admin Dashboard
    â””â”€â”€ AI Review Edge Function
    â”‚
    â†“
Phase 5: æ¸¸æˆåŒ–ç³»ç»Ÿ (å¢é•¿å¼•æ“)
    â”‚
    â”œâ”€â”€ Success Score (GENERATED ALWAYS)
    â”œâ”€â”€ ç­‰çº§ç³»ç»Ÿ (è§¦å‘å™¨è‡ªåŠ¨å‡çº§)
    â””â”€â”€ å¾½ç« ç³»ç»Ÿ (å®Œæ•´å®ç°)
    â”‚
    â†“
Phase 6: SEO + å¯è®¿é—®æ€§ (åˆè§„è¦æ±‚)
    â”‚
    â”œâ”€â”€ ç»“æ„åŒ–æ•°æ® (Schema.org)
    â”œâ”€â”€ WCAG 2.2 åˆè§„
    â””â”€â”€ å¯è®¿é—®æ€§å·¥å…·åº“
    â”‚
    â†“
Phase 7: æµ‹è¯•å®Œå–„ (è´¨é‡ä¿è¯)
    â”‚
    â”œâ”€â”€ E2E æµ‹è¯• (80%+)
    â”œâ”€â”€ å•å…ƒæµ‹è¯• (70%+)
    â””â”€â”€ CI/CD é…ç½®
```

### 1.2 æ—¶é—´å’Œå·¥æ—¶ä¼°ç®—

| Phase | æ—¶é—´ | å·¥æ—¶ | æ ¸å¿ƒä»»åŠ¡ |
|-------|------|------|----------|
| Phase 0 | 1å¤© | 4h | åŸºç¡€è®¾æ–½å‡†å¤‡ |
| Phase 1 | 3å¤© | 24h | P0 Bug ä¿®å¤ |
| Phase 2 | 2å¤© | 16h | ç›‘æ§ä½“ç³» |
| Phase 3 | 2å¤© | 16h | æ€§èƒ½ä¼˜åŒ– |
| Phase 4 | 4å¤© | 32h | Admin + AI Review |
| Phase 5 | 3å¤© | 24h | æ¸¸æˆåŒ–ç³»ç»Ÿ |
| Phase 6 | 3å¤© | 24h | SEO + å¯è®¿é—®æ€§ |
| Phase 7 | 2å¤© | 16h | æµ‹è¯•å®Œå–„ |
| **æ€»è®¡** | **20å¤©** | **156h** | |

### 1.3 é¢„æœŸæˆæœ

| æŒ‡æ ‡ | å½“å‰ | ç›®æ ‡ | æå‡ |
|------|------|------|------|
| ç»¼åˆè¯„åˆ† | 6.3/10 | 8.7/10 | +2.4 |
| E2E æµ‹è¯•é€šè¿‡ç‡ | 53.1% | 90%+ | +37% |
| å•å…ƒæµ‹è¯•è¦†ç›– | 0% | 70%+ | +70% |
| Lighthouse Performance | ~70 | 95+ | +25 |
| é¦–å±åŠ è½½æ—¶é—´ | ~3s | <1.5s | -50% |
| Bundle å¤§å° | ~500KB | <250KB | -50% |

---

## äºŒã€Phase 0: åŸºç¡€è®¾æ–½å‡†å¤‡

> **æ¥æº**: Claude æ–¹æ¡ˆ  
> **æ—¶é—´**: 1å¤©  
> **ç›®æ ‡**: å»ºç«‹ä¸“ä¸šçš„å¼€å‘ç¯å¢ƒå’Œåˆ†æ”¯ç­–ç•¥

### 2.1 åˆ›å»ºå¼€å‘åˆ†æ”¯

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/SwordKirito33/follow-ai.git
cd follow-ai

# 2. åˆ›å»ºä¸»åŠŸèƒ½åˆ†æ”¯
git checkout -b feat/comprehensive-fixes

# 3. åˆ›å»ºå­åˆ†æ”¯ï¼ˆæŒ‰ Phase åˆ’åˆ†ï¼‰
git checkout -b feat/phase0-infrastructure
```

### 2.2 å®‰è£…å¿…è¦ä¾èµ–

```bash
# æ ¸å¿ƒä¾èµ–
pnpm add @sentry/react posthog-js zod react-hook-form @hookform/resolvers
pnpm add react-helmet-async framer-motion

# å¼€å‘ä¾èµ–
pnpm add -D vitest @testing-library/react @testing-library/jest-dom @testing-library/user-event
pnpm add -D vite-plugin-compression rollup-plugin-visualizer
pnpm add -D sharp vite-plugin-image-optimizer
pnpm add -D @playwright/test
```

### 2.3 æ›´æ–° package.json

```json
{
  "scripts": {
    "dev": "vite",
    "build": "tsc && vite build",
    "preview": "vite preview",
    "lint": "eslint . --ext ts,tsx --report-unused-disable-directives --max-warnings 0",
    "type-check": "tsc --noEmit",
    "test": "vitest",
    "test:run": "vitest run",
    "test:coverage": "vitest run --coverage",
    "test:e2e": "playwright test",
    "test:e2e:ui": "playwright test --ui",
    "test:all": "pnpm test:run && pnpm test:e2e",
    "analyze": "vite build && npx vite-bundle-visualizer"
  }
}
```

### 2.4 TypeScript é…ç½®ä¼˜åŒ–

```json
// tsconfig.json
{
  "compilerOptions": {
    "target": "ES2020",
    "useDefineForClassFields": true,
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "module": "ESNext",
    "skipLibCheck": true,
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noFallthroughCasesInSwitch": true,
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "resolveJsonModule": true,
    "isolatedModules": true,
    "noEmit": true,
    "jsx": "react-jsx",
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": ["src"],
  "references": [{ "path": "./tsconfig.node.json" }]
}
```

### 2.5 ç¯å¢ƒå˜é‡é…ç½®

åˆ›å»º `.env.local`:

```bash
# Supabase
VITE_SUPABASE_URL=https://nbvnnhojvkxfnididast.supabase.co
VITE_SUPABASE_ANON_KEY=ä½ çš„anon_key

# ç›‘æ§
VITE_SENTRY_DSN=å¾…é…ç½®
VITE_POSTHOG_KEY=å¾…é…ç½®
VITE_POSTHOG_HOST=https://app.posthog.com

# åº”ç”¨
VITE_APP_VERSION=1.0.0
VITE_APP_URL=https://follow.ai

# æµ‹è¯•
TEST_USER_EMAIL=test@example.com
TEST_USER_PASSWORD=testpassword123
PLAYWRIGHT_TEST_BASE_URL=https://follow.ai
```

### 2.6 éªŒè¯æ­¥éª¤

```bash
# 1. éªŒè¯ä¾èµ–å®‰è£…
pnpm install
pnpm type-check

# 2. éªŒè¯å¼€å‘æœåŠ¡å™¨
pnpm dev
# è®¿é—® http://localhost:5173 ç¡®è®¤æ­£å¸¸è¿è¡Œ

# 3. éªŒè¯æ„å»º
pnpm build
# ç¡®è®¤æ— é”™è¯¯

# 4. æäº¤ Phase 0
git add -A
git commit -m "chore: Phase 0 - Infrastructure setup"
git push origin feat/phase0-infrastructure
```

---

## ä¸‰ã€Phase 1: P0 Bug ä¿®å¤

> **æ¥æº**: Claude æ–¹æ¡ˆï¼ˆä»£ç æ›´å®Œæ•´ï¼‰  
> **æ—¶é—´**: 3å¤©  
> **ç›®æ ‡**: ä¿®å¤æ‰€æœ‰é˜»å¡æ€§é—®é¢˜

### 3.1 ç™»å‡ºæµç¨‹ä¿®å¤

**é—®é¢˜è¯Šæ–­**:
- localStorage æ®‹ç•™
- Supabase session æœªå®Œå…¨æ¸…ç†
- React Query ç¼“å­˜æ±¡æŸ“
- å®æ—¶è®¢é˜…æœªæ¸…ç†

#### Step 3.1.1: åˆ›å»º React Query å®¢æˆ·ç«¯

```typescript
// src/lib/react-query.ts (æ–°å»º)
import { QueryClient } from '@tanstack/react-query';

export const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      staleTime: 1000 * 60 * 5, // 5åˆ†é’Ÿ
      gcTime: 1000 * 60 * 30, // 30åˆ†é’Ÿ
      retry: 1,
      refetchOnWindowFocus: false,
    },
  },
});
```

#### Step 3.1.2: åˆ›å»ºç»Ÿä¸€ç™»å‡ºå·¥å…·å‡½æ•°

```typescript
// src/lib/auth-utils.ts (æ–°å»º)
import { supabase } from './supabase';
import { queryClient } from './react-query';

/**
 * å®Œæ•´ç™»å‡ºæµç¨‹
 * æ¸…ç†æ‰€æœ‰ä¼šè¯ã€å­˜å‚¨å’Œç¼“å­˜
 */
export async function performSignOut(): Promise<void> {
  try {
    // 1. Supabase ç™»å‡º
    const { error } = await supabase.auth.signOut();
    if (error) {
      console.error('Supabase signOut error:', error);
      // ç»§ç»­æ‰§è¡Œæ¸…ç†ï¼Œå³ä½¿ Supabase è°ƒç”¨å¤±è´¥
    }

    // 2. æ¸…ç†æ‰€æœ‰å­˜å‚¨
    localStorage.clear();
    sessionStorage.clear();

    // 3. æ¸…ç† React Query ç¼“å­˜
    queryClient.clear();

    // 4. æ¸…ç† Supabase å®æ—¶è®¢é˜…
    await supabase.removeAllChannels();

    // 5. æ¸…ç† IndexedDBï¼ˆå¦‚æœä½¿ç”¨ï¼‰
    if ('indexedDB' in window) {
      const databases = await indexedDB.databases();
      databases.forEach(db => {
        if (db.name) indexedDB.deleteDatabase(db.name);
      });
    }

    console.log('Sign out completed successfully');
  } catch (error) {
    console.error('Sign out error:', error);
    throw error;
  }
}

/**
 * æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²è®¤è¯
 */
export async function checkAuthStatus(): Promise<boolean> {
  const { data: { session } } = await supabase.auth.getSession();
  return !!session;
}
```

#### Step 3.1.3: æ›´æ–° AuthContext

```typescript
// src/contexts/AuthContext.tsx (ä¿®æ”¹)
import { createContext, useContext, useState, useEffect, useCallback, ReactNode } from 'react';
import { User, Session } from '@supabase/supabase-js';
import { supabase } from '@/lib/supabase';
import { performSignOut } from '@/lib/auth-utils';

interface AuthContextType {
  user: User | null;
  session: Session | null;
  profile: Profile | null;
  loading: boolean;
  signIn: (email: string, password: string) => Promise<void>;
  signUp: (email: string, password: string, username: string) => Promise<void>;
  signOut: () => Promise<void>;
  refreshProfile: () => Promise<void>;
}

interface Profile {
  id: string;
  username: string;
  avatar_url: string | null;
  xp: number;
  level: number;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [profile, setProfile] = useState<Profile | null>(null);
  const [loading, setLoading] = useState(true);

  // è·å–ç”¨æˆ·èµ„æ–™
  const fetchProfile = useCallback(async (userId: string) => {
    try {
      const { data, error } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', userId)
        .single();

      if (error) throw error;
      setProfile(data);
    } catch (error) {
      console.error('Error fetching profile:', error);
      setProfile(null);
    }
  }, []);

  // åˆ·æ–°ç”¨æˆ·èµ„æ–™
  const refreshProfile = useCallback(async () => {
    if (user) {
      await fetchProfile(user.id);
    }
  }, [user, fetchProfile]);

  // åˆå§‹åŒ–è®¤è¯çŠ¶æ€
  useEffect(() => {
    const initAuth = async () => {
      try {
        const { data: { session } } = await supabase.auth.getSession();
        setSession(session);
        setUser(session?.user ?? null);
        
        if (session?.user) {
          await fetchProfile(session.user.id);
        }
      } catch (error) {
        console.error('Auth initialization error:', error);
      } finally {
        setLoading(false);
      }
    };

    initAuth();

    // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
    const { data: { subscription } } = supabase.auth.onAuthStateChange(
      async (event, session) => {
        setSession(session);
        setUser(session?.user ?? null);
        
        if (session?.user) {
          await fetchProfile(session.user.id);
        } else {
          setProfile(null);
        }
      }
    );

    return () => {
      subscription.unsubscribe();
    };
  }, [fetchProfile]);

  // ç™»å½•
  const signIn = useCallback(async (email: string, password: string) => {
    setLoading(true);
    try {
      const { error } = await supabase.auth.signInWithPassword({
        email,
        password,
      });
      if (error) throw error;
    } finally {
      setLoading(false);
    }
  }, []);

  // æ³¨å†Œ
  const signUp = useCallback(async (email: string, password: string, username: string) => {
    setLoading(true);
    try {
      const { data, error } = await supabase.auth.signUp({
        email,
        password,
        options: {
          data: { username },
        },
      });
      if (error) throw error;
      
      // åˆ›å»ºç”¨æˆ·èµ„æ–™
      if (data.user) {
        await supabase.from('profiles').insert({
          id: data.user.id,
          username,
          xp: 0,
          level: 1,
        });
      }
    } finally {
      setLoading(false);
    }
  }, []);

  // ç™»å‡º - ä½¿ç”¨å®Œæ•´æ¸…ç†æµç¨‹
  const signOut = useCallback(async () => {
    try {
      setLoading(true);
      await performSignOut();
      setUser(null);
      setSession(null);
      setProfile(null);
      // å¼ºåˆ¶é‡å®šå‘åˆ°é¦–é¡µ
      window.location.href = '/';
    } catch (error) {
      console.error('Sign out failed:', error);
      // å³ä½¿å¤±è´¥ä¹Ÿæ¸…ç†æœ¬åœ°çŠ¶æ€
      setUser(null);
      setSession(null);
      setProfile(null);
      window.location.href = '/';
    } finally {
      setLoading(false);
    }
  }, []);

  return (
    <AuthContext.Provider
      value={{
        user,
        session,
        profile,
        loading,
        signIn,
        signUp,
        signOut,
        refreshProfile,
      }}
    >
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}
```

#### Step 3.1.4: æ·»åŠ ç™»å‡ºæŒ‰é’® data-testid

```tsx
// src/components/Navbar.tsx (ä¿®æ”¹ç›¸å…³éƒ¨åˆ†)
// æ¡Œé¢ç«¯ç™»å‡ºæŒ‰é’®
<button
  onClick={handleSignOut}
  data-testid="logout-button"
  className="flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-100 rounded-md transition-colors"
>
  <LogOut className="w-4 h-4" />
  <span>ç™»å‡º</span>
</button>

// ç§»åŠ¨ç«¯ç™»å‡ºæŒ‰é’®
<button
  onClick={handleSignOut}
  data-testid="logout-button-mobile"
  className="w-full flex items-center gap-2 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-100"
>
  <LogOut className="w-4 h-4" />
  <span>ç™»å‡º</span>
</button>
```

#### Step 3.1.5: éªŒè¯ç™»å‡ºæµç¨‹

```bash
# æ‰‹åŠ¨æµ‹è¯•
1. ç™»å½•è´¦æˆ·
2. æ‰“å¼€å¼€å‘è€…å·¥å…· > Application > Local Storage
3. ç‚¹å‡»ç™»å‡ºæŒ‰é’®
4. æ£€æŸ¥ Local Storage (åº”è¯¥ä¸ºç©º)
5. æ£€æŸ¥ Network æ ‡ç­¾ (Supabase auth è¯·æ±‚æˆåŠŸ)
6. ç¡®è®¤é‡å®šå‘åˆ°é¦–é¡µ
7. å°è¯•è®¿é—® /dashboard (åº”è¯¥é‡å®šå‘åˆ°é¦–é¡µ)

# E2E æµ‹è¯•
npx playwright test tests/e2e/auth.spec.ts -g "logout"
```

---

### 3.2 é€šçŸ¥é¢æ¿ä¿®å¤

**é—®é¢˜è¯Šæ–­**:
- State ç«æ€æ¡ä»¶
- ç¼ºå°‘ä¹è§‚æ›´æ–°
- é¢æ¿æ‰“å¼€/å…³é—­çŠ¶æ€ç®¡ç†æ··ä¹±

#### Step 3.2.1: é‡æ„é€šçŸ¥ä¸­å¿ƒç»„ä»¶

```typescript
// src/components/NotificationCenter.tsx (é‡æ„)
import { useState, useEffect, useTransition, useOptimistic, useCallback, useRef } from 'react';
import { Bell, Check, X, Trash2 } from 'lucide-react';
import { supabase } from '@/lib/supabase';
import { useAuth } from '@/contexts/AuthContext';
import { formatDistanceToNow } from 'date-fns';
import { zhCN } from 'date-fns/locale';

interface Notification {
  id: string;
  title: string;
  message: string;
  type: 'info' | 'success' | 'warning' | 'error';
  read: boolean;
  created_at: string;
}

export function NotificationCenter() {
  const { user } = useAuth();
  const [isOpen, setIsOpen] = useState(false);
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [loading, setLoading] = useState(true);
  const [isPending, startTransition] = useTransition();
  const panelRef = useRef<HTMLDivElement>(null);

  // ä¹è§‚æ›´æ–°
  const [optimisticNotifications, setOptimisticNotifications] = useOptimistic(
    notifications,
    (state, action: { type: 'markRead' | 'delete'; id: string }) => {
      switch (action.type) {
        case 'markRead':
          return state.map(n => n.id === action.id ? { ...n, read: true } : n);
        case 'delete':
          return state.filter(n => n.id !== action.id);
        default:
          return state;
      }
    }
  );

  // è·å–é€šçŸ¥
  const fetchNotifications = useCallback(async () => {
    if (!user) return;
    
    try {
      const { data, error } = await supabase
        .from('notifications')
        .select('*')
        .eq('user_id', user.id)
        .order('created_at', { ascending: false })
        .limit(20);

      if (error) throw error;
      setNotifications(data || []);
    } catch (error) {
      console.error('Error fetching notifications:', error);
    } finally {
      setLoading(false);
    }
  }, [user]);

  // åˆå§‹åŒ–å’Œå®æ—¶è®¢é˜…
  useEffect(() => {
    fetchNotifications();

    if (!user) return;

    // å®æ—¶è®¢é˜…æ–°é€šçŸ¥
    const channel = supabase
      .channel('notifications')
      .on(
        'postgres_changes',
        {
          event: 'INSERT',
          schema: 'public',
          table: 'notifications',
          filter: `user_id=eq.${user.id}`,
        },
        (payload) => {
          setNotifications(prev => [payload.new as Notification, ...prev]);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
    };
  }, [user, fetchNotifications]);

  // ç‚¹å‡»å¤–éƒ¨å…³é—­
  useEffect(() => {
    const handleClickOutside = (event: MouseEvent) => {
      if (panelRef.current && !panelRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    };

    if (isOpen) {
      document.addEventListener('mousedown', handleClickOutside);
    }

    return () => {
      document.removeEventListener('mousedown', handleClickOutside);
    };
  }, [isOpen]);

  // æ ‡è®°ä¸ºå·²è¯»
  const markAsRead = async (id: string) => {
    startTransition(() => {
      setOptimisticNotifications({ type: 'markRead', id });
    });

    const { error } = await supabase
      .from('notifications')
      .update({ read: true })
      .eq('id', id);

    if (error) {
      console.error('Mark as read failed:', error);
      // å›æ»šï¼šé‡æ–°è·å–æ•°æ®
      fetchNotifications();
    } else {
      setNotifications(prev =>
        prev.map(n => n.id === id ? { ...n, read: true } : n)
      );
    }
  };

  // åˆ é™¤é€šçŸ¥
  const deleteNotification = async (id: string) => {
    startTransition(() => {
      setOptimisticNotifications({ type: 'delete', id });
    });

    const { error } = await supabase
      .from('notifications')
      .delete()
      .eq('id', id);

    if (error) {
      console.error('Delete notification failed:', error);
      fetchNotifications();
    } else {
      setNotifications(prev => prev.filter(n => n.id !== id));
    }
  };

  // å…¨éƒ¨æ ‡è®°ä¸ºå·²è¯»
  const markAllAsRead = async () => {
    const unreadIds = notifications.filter(n => !n.read).map(n => n.id);
    
    startTransition(() => {
      unreadIds.forEach(id => {
        setOptimisticNotifications({ type: 'markRead', id });
      });
    });

    const { error } = await supabase
      .from('notifications')
      .update({ read: true })
      .eq('user_id', user?.id)
      .eq('read', false);

    if (error) {
      console.error('Mark all as read failed:', error);
      fetchNotifications();
    } else {
      setNotifications(prev => prev.map(n => ({ ...n, read: true })));
    }
  };

  const unreadCount = optimisticNotifications.filter(n => !n.read).length;

  const getTypeStyles = (type: Notification['type']) => {
    switch (type) {
      case 'success': return 'bg-green-50 border-green-200';
      case 'warning': return 'bg-yellow-50 border-yellow-200';
      case 'error': return 'bg-red-50 border-red-200';
      default: return 'bg-blue-50 border-blue-200';
    }
  };

  return (
    <div className="relative" ref={panelRef}>
      {/* é€šçŸ¥æŒ‰é’® */}
      <button
        onClick={() => setIsOpen(!isOpen)}
        data-testid="notifications-button"
        className="relative p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-full transition-colors"
        aria-label="é€šçŸ¥ä¸­å¿ƒ"
        aria-expanded={isOpen}
        aria-haspopup="true"
      >
        <Bell className="w-6 h-6" />
        {unreadCount > 0 && (
          <span className="absolute -top-1 -right-1 w-5 h-5 bg-red-500 text-white text-xs font-bold rounded-full flex items-center justify-center">
            {unreadCount > 9 ? '9+' : unreadCount}
          </span>
        )}
      </button>

      {/* é€šçŸ¥é¢æ¿ */}
      {isOpen && (
        <div
          data-testid="notifications-panel"
          className="absolute right-0 mt-2 w-96 bg-white rounded-xl shadow-2xl border border-gray-200 z-50 overflow-hidden"
          role="dialog"
          aria-label="é€šçŸ¥åˆ—è¡¨"
        >
          {/* å¤´éƒ¨ */}
          <div className="flex items-center justify-between p-4 border-b border-gray-100">
            <h3 className="text-lg font-semibold text-gray-900">é€šçŸ¥</h3>
            <div className="flex items-center gap-2">
              {unreadCount > 0 && (
                <button
                  onClick={markAllAsRead}
                  disabled={isPending}
                  className="text-sm text-blue-600 hover:text-blue-800 disabled:opacity-50"
                >
                  å…¨éƒ¨å·²è¯»
                </button>
              )}
              <button
                onClick={() => setIsOpen(false)}
                className="p-1 text-gray-400 hover:text-gray-600"
                aria-label="å…³é—­"
              >
                <X className="w-5 h-5" />
              </button>
            </div>
          </div>

          {/* é€šçŸ¥åˆ—è¡¨ */}
          <div className="max-h-96 overflow-y-auto">
            {loading ? (
              <div className="p-8 text-center">
                <div className="animate-spin w-8 h-8 border-2 border-blue-500 border-t-transparent rounded-full mx-auto" />
              </div>
            ) : optimisticNotifications.length === 0 ? (
              <div className="p-8 text-center">
                <Bell className="w-12 h-12 text-gray-300 mx-auto mb-3" />
                <p className="text-gray-500">æš‚æ— é€šçŸ¥</p>
              </div>
            ) : (
              <ul className="divide-y divide-gray-100">
                {optimisticNotifications.map(notification => (
                  <li
                    key={notification.id}
                    className={`p-4 hover:bg-gray-50 transition-colors ${
                      !notification.read ? 'bg-blue-50/50' : ''
                    }`}
                  >
                    <div className="flex gap-3">
                      <div className={`w-2 h-2 mt-2 rounded-full flex-shrink-0 ${
                        notification.read ? 'bg-gray-300' : 'bg-blue-500'
                      }`} />
                      <div className="flex-1 min-w-0">
                        <div className="flex items-start justify-between gap-2">
                          <h4 className="font-medium text-gray-900 truncate">
                            {notification.title}
                          </h4>
                          <div className="flex items-center gap-1 flex-shrink-0">
                            {!notification.read && (
                              <button
                                onClick={() => markAsRead(notification.id)}
                                disabled={isPending}
                                className="p-1 text-gray-400 hover:text-green-600"
                                title="æ ‡è®°å·²è¯»"
                              >
                                <Check className="w-4 h-4" />
                              </button>
                            )}
                            <button
                              onClick={() => deleteNotification(notification.id)}
                              disabled={isPending}
                              className="p-1 text-gray-400 hover:text-red-600"
                              title="åˆ é™¤"
                            >
                              <Trash2 className="w-4 h-4" />
                            </button>
                          </div>
                        </div>
                        <p className="text-sm text-gray-600 mt-1 line-clamp-2">
                          {notification.message}
                        </p>
                        <p className="text-xs text-gray-400 mt-2">
                          {formatDistanceToNow(new Date(notification.created_at), {
                            addSuffix: true,
                            locale: zhCN,
                          })}
                        </p>
                      </div>
                    </div>
                  </li>
                ))}
              </ul>
            )}
          </div>
        </div>
      )}
    </div>
  );
}
```

#### Step 3.2.2: éªŒè¯é€šçŸ¥é¢æ¿

```bash
# æ‰‹åŠ¨æµ‹è¯•
1. ç‚¹å‡»é€šçŸ¥æŒ‰é’® â†’ é¢æ¿åº”æ‰“å¼€
2. ç‚¹å‡»é¢æ¿å¤–éƒ¨ â†’ é¢æ¿åº”å…³é—­
3. ç‚¹å‡»"æ ‡è®°å·²è¯»" â†’ åº”ç«‹å³æ›´æ–° UIï¼ˆä¹è§‚æ›´æ–°ï¼‰
4. ç‚¹å‡»"åˆ é™¤" â†’ åº”ç«‹å³ä»åˆ—è¡¨ç§»é™¤
5. ç‚¹å‡»"å…¨éƒ¨å·²è¯»" â†’ æ‰€æœ‰é€šçŸ¥åº”æ ‡è®°ä¸ºå·²è¯»

# E2E æµ‹è¯•
npx playwright test tests/e2e/dashboard.spec.ts -g "notifications"
```

---

### 3.3 è¡¨å•éªŒè¯ç»Ÿä¸€

#### Step 3.3.1: åˆ›å»º Zod Schema

```typescript
// src/lib/validations.ts (æ–°å»º)
import { z } from 'zod';

// é‚®ç®±éªŒè¯
export const emailSchema = z
  .string()
  .min(1, 'è¯·è¾“å…¥é‚®ç®±')
  .email('é‚®ç®±æ ¼å¼ä¸æ­£ç¡®');

// å¯†ç éªŒè¯ï¼ˆç™»å½•ç”¨ï¼Œå®½æ¾ï¼‰
export const passwordSchema = z
  .string()
  .min(1, 'è¯·è¾“å…¥å¯†ç ');

// å¼ºå¯†ç éªŒè¯ï¼ˆæ³¨å†Œç”¨ï¼Œä¸¥æ ¼ï¼‰
export const strongPasswordSchema = z
  .string()
  .min(8, 'å¯†ç è‡³å°‘8ä¸ªå­—ç¬¦')
  .max(100, 'å¯†ç ä¸èƒ½è¶…è¿‡100ä¸ªå­—ç¬¦')
  .regex(/[A-Z]/, 'å¯†ç å¿…é¡»åŒ…å«å¤§å†™å­—æ¯')
  .regex(/[a-z]/, 'å¯†ç å¿…é¡»åŒ…å«å°å†™å­—æ¯')
  .regex(/[0-9]/, 'å¯†ç å¿…é¡»åŒ…å«æ•°å­—');

// ç”¨æˆ·åéªŒè¯
export const usernameSchema = z
  .string()
  .min(3, 'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦')
  .max(20, 'ç”¨æˆ·åä¸èƒ½è¶…è¿‡20ä¸ªå­—ç¬¦')
  .regex(/^[a-zA-Z0-9_]+$/, 'ç”¨æˆ·ååªèƒ½åŒ…å«å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿');

// ç™»å½•è¡¨å•
export const loginSchema = z.object({
  email: emailSchema,
  password: passwordSchema,
});

// æ³¨å†Œè¡¨å•
export const registerSchema = z.object({
  email: emailSchema,
  username: usernameSchema,
  password: strongPasswordSchema,
  confirmPassword: z.string(),
}).refine((data) => data.password === data.confirmPassword, {
  message: 'ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´',
  path: ['confirmPassword'],
});

// ç±»å‹å¯¼å‡º
export type LoginFormData = z.infer<typeof loginSchema>;
export type RegisterFormData = z.infer<typeof registerSchema>;
```

#### Step 3.3.2: é‡æ„ AuthModal

```tsx
// src/components/AuthModal.tsx (é‡æ„)
import { useState, useEffect } from 'react';
import { useForm } from 'react-hook-form';
import { zodResolver } from '@hookform/resolvers/zod';
import { X, Eye, EyeOff, Mail, Lock, User, AlertCircle, Loader2 } from 'lucide-react';
import { useAuth } from '@/contexts/AuthContext';
import { 
  loginSchema, 
  registerSchema, 
  type LoginFormData, 
  type RegisterFormData 
} from '@/lib/validations';

interface AuthModalProps {
  isOpen: boolean;
  onClose: () => void;
  initialMode?: 'login' | 'register';
}

export function AuthModal({ isOpen, onClose, initialMode = 'login' }: AuthModalProps) {
  const [mode, setMode] = useState<'login' | 'register'>(initialMode);
  const [showPassword, setShowPassword] = useState(false);
  const [serverError, setServerError] = useState<string | null>(null);
  const { signIn, signUp } = useAuth();

  // ç™»å½•è¡¨å•
  const loginForm = useForm<LoginFormData>({
    resolver: zodResolver(loginSchema),
    mode: 'onBlur',
    defaultValues: {
      email: '',
      password: '',
    },
  });

  // æ³¨å†Œè¡¨å•
  const registerForm = useForm<RegisterFormData>({
    resolver: zodResolver(registerSchema),
    mode: 'onBlur',
    defaultValues: {
      email: '',
      username: '',
      password: '',
      confirmPassword: '',
    },
  });

  const currentForm = mode === 'login' ? loginForm : registerForm;
  const { formState: { errors, isSubmitting } } = currentForm;

  // åˆ‡æ¢æ¨¡å¼æ—¶é‡ç½®è¡¨å•
  useEffect(() => {
    setServerError(null);
    loginForm.reset();
    registerForm.reset();
  }, [mode]);

  // å…³é—­æ—¶é‡ç½®
  useEffect(() => {
    if (!isOpen) {
      setServerError(null);
      setMode(initialMode);
      loginForm.reset();
      registerForm.reset();
    }
  }, [isOpen, initialMode]);

  // ç™»å½•æäº¤
  const handleLogin = async (data: LoginFormData) => {
    try {
      setServerError(null);
      await signIn(data.email, data.password);
      onClose();
    } catch (error: any) {
      setServerError(error.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥é‚®ç®±å’Œå¯†ç ');
    }
  };

  // æ³¨å†Œæäº¤
  const handleRegister = async (data: RegisterFormData) => {
    try {
      setServerError(null);
      await signUp(data.email, data.password, data.username);
      onClose();
    } catch (error: any) {
      setServerError(error.message || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
    }
  };

  if (!isOpen) return null;

  return (
    <div 
      className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm"
      onClick={(e) => e.target === e.currentTarget && onClose()}
    >
      <div 
        data-testid="auth-modal"
        className="relative w-full max-w-md bg-white rounded-2xl shadow-2xl p-8 m-4"
        role="dialog"
        aria-modal="true"
        aria-labelledby="auth-modal-title"
      >
        {/* å…³é—­æŒ‰é’® */}
        <button
          onClick={onClose}
          className="absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 rounded-full hover:bg-gray-100"
          aria-label="å…³é—­"
        >
          <X className="w-5 h-5" />
        </button>

        {/* æ ‡é¢˜ */}
        <h2 id="auth-modal-title" className="text-2xl font-bold text-gray-900 mb-6">
          {mode === 'login' ? 'æ¬¢è¿å›æ¥' : 'åˆ›å»ºè´¦æˆ·'}
        </h2>

        {/* æœåŠ¡å™¨é”™è¯¯ */}
        {serverError && (
          <div 
            data-testid="error-message"
            className="mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2 text-red-700"
            role="alert"
          >
            <AlertCircle className="w-5 h-5 flex-shrink-0" />
            <span className="text-sm">{serverError}</span>
          </div>
        )}

        {/* ç™»å½•è¡¨å• */}
        {mode === 'login' && (
          <form onSubmit={loginForm.handleSubmit(handleLogin)} className="space-y-4">
            {/* é‚®ç®± */}
            <div>
              <label htmlFor="login-email" className="block text-sm font-medium text-gray-700 mb-1">
                é‚®ç®±
              </label>
              <div className="relative">
                <Mail className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                <input
                  {...loginForm.register('email')}
                  type="email"
                  id="login-email"
                  data-testid="email-input"
                  placeholder="your@email.com"
                  className={`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
                    errors.email ? 'border-red-500' : 'border-gray-300'
                  }`}
                  aria-invalid={errors.email ? 'true' : 'false'}
                  aria-describedby={errors.email ? 'email-error' : undefined}
                />
              </div>
              {errors.email && (
                <p id="email-error" data-testid="email-error" className="mt-1 text-sm text-red-600">
                  {errors.email.message}
                </p>
              )}
            </div>

            {/* å¯†ç  */}
            <div>
              <label htmlFor="login-password" className="block text-sm font-medium text-gray-700 mb-1">
                å¯†ç 
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                <input
                  {...loginForm.register('password')}
                  type={showPassword ? 'text' : 'password'}
                  id="login-password"
                  data-testid="password-input"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  className={`w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
                    errors.password ? 'border-red-500' : 'border-gray-300'
                  }`}
                  aria-invalid={errors.password ? 'true' : 'false'}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                  aria-label={showPassword ? 'éšè—å¯†ç ' : 'æ˜¾ç¤ºå¯†ç '}
                >
                  {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                </button>
              </div>
              {errors.password && (
                <p data-testid="password-error" className="mt-1 text-sm text-red-600">
                  {errors.password.message}
                </p>
              )}
            </div>

            {/* æäº¤æŒ‰é’® */}
            <button
              type="submit"
              disabled={isSubmitting}
              data-testid="submit-button"
              className="w-full py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
            >
              {isSubmitting ? (
                <>
                  <Loader2 className="w-5 h-5 animate-spin" />
                  <span>ç™»å½•ä¸­...</span>
                </>
              ) : (
                'ç™»å½•'
              )}
            </button>
          </form>
        )}

        {/* æ³¨å†Œè¡¨å• */}
        {mode === 'register' && (
          <form onSubmit={registerForm.handleSubmit(handleRegister)} className="space-y-4">
            {/* é‚®ç®± */}
            <div>
              <label htmlFor="register-email" className="block text-sm font-medium text-gray-700 mb-1">
                é‚®ç®±
              </label>
              <div className="relative">
                <Mail className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                <input
                  {...registerForm.register('email')}
                  type="email"
                  id="register-email"
                  data-testid="email-input"
                  placeholder="your@email.com"
                  className={`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
                    registerForm.formState.errors.email ? 'border-red-500' : 'border-gray-300'
                  }`}
                />
              </div>
              {registerForm.formState.errors.email && (
                <p data-testid="email-error" className="mt-1 text-sm text-red-600">
                  {registerForm.formState.errors.email.message}
                </p>
              )}
            </div>

            {/* ç”¨æˆ·å */}
            <div>
              <label htmlFor="register-username" className="block text-sm font-medium text-gray-700 mb-1">
                ç”¨æˆ·å
              </label>
              <div className="relative">
                <User className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                <input
                  {...registerForm.register('username')}
                  type="text"
                  id="register-username"
                  data-testid="username-input"
                  placeholder="your_username"
                  className={`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
                    registerForm.formState.errors.username ? 'border-red-500' : 'border-gray-300'
                  }`}
                />
              </div>
              {registerForm.formState.errors.username && (
                <p data-testid="username-error" className="mt-1 text-sm text-red-600">
                  {registerForm.formState.errors.username.message}
                </p>
              )}
            </div>

            {/* å¯†ç  */}
            <div>
              <label htmlFor="register-password" className="block text-sm font-medium text-gray-700 mb-1">
                å¯†ç 
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                <input
                  {...registerForm.register('password')}
                  type={showPassword ? 'text' : 'password'}
                  id="register-password"
                  data-testid="password-input"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  className={`w-full pl-10 pr-12 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
                    registerForm.formState.errors.password ? 'border-red-500' : 'border-gray-300'
                  }`}
                />
                <button
                  type="button"
                  onClick={() => setShowPassword(!showPassword)}
                  className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
                >
                  {showPassword ? <EyeOff className="w-5 h-5" /> : <Eye className="w-5 h-5" />}
                </button>
              </div>
              {registerForm.formState.errors.password && (
                <p data-testid="password-error" className="mt-1 text-sm text-red-600">
                  {registerForm.formState.errors.password.message}
                </p>
              )}
            </div>

            {/* ç¡®è®¤å¯†ç  */}
            <div>
              <label htmlFor="register-confirm-password" className="block text-sm font-medium text-gray-700 mb-1">
                ç¡®è®¤å¯†ç 
              </label>
              <div className="relative">
                <Lock className="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
                <input
                  {...registerForm.register('confirmPassword')}
                  type={showPassword ? 'text' : 'password'}
                  id="register-confirm-password"
                  data-testid="confirm-password-input"
                  placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                  className={`w-full pl-10 pr-4 py-3 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent ${
                    registerForm.formState.errors.confirmPassword ? 'border-red-500' : 'border-gray-300'
                  }`}
                />
              </div>
              {registerForm.formState.errors.confirmPassword && (
                <p data-testid="confirm-password-error" className="mt-1 text-sm text-red-600">
                  {registerForm.formState.errors.confirmPassword.message}
                </p>
              )}
            </div>

            {/* æäº¤æŒ‰é’® */}
            <button
              type="submit"
              disabled={isSubmitting}
              data-testid="submit-button"
              className="w-full py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
            >
              {isSubmitting ? (
                <>
                  <Loader2 className="w-5 h-5 animate-spin" />
                  <span>æ³¨å†Œä¸­...</span>
                </>
              ) : (
                'æ³¨å†Œ'
              )}
            </button>
          </form>
        )}

        {/* åˆ‡æ¢æ¨¡å¼ */}
        <p className="mt-6 text-center text-sm text-gray-600">
          {mode === 'login' ? (
            <>
              è¿˜æ²¡æœ‰è´¦æˆ·ï¼Ÿ{' '}
              <button
                onClick={() => setMode('register')}
                className="text-blue-600 hover:text-blue-800 font-medium"
              >
                ç«‹å³æ³¨å†Œ
              </button>
            </>
          ) : (
            <>
              å·²æœ‰è´¦æˆ·ï¼Ÿ{' '}
              <button
                onClick={() => setMode('login')}
                className="text-blue-600 hover:text-blue-800 font-medium"
              >
                ç«‹å³ç™»å½•
              </button>
            </>
          )}
        </p>
      </div>
    </div>
  );
}
```

#### Step 3.3.3: éªŒè¯è¡¨å•éªŒè¯

```bash
# æ‰‹åŠ¨æµ‹è¯•
1. è¾“å…¥æ— æ•ˆé‚®ç®± â†’ åº”æ˜¾ç¤º"é‚®ç®±æ ¼å¼ä¸æ­£ç¡®"
2. è¾“å…¥çŸ­å¯†ç  â†’ åº”æ˜¾ç¤º"å¯†ç è‡³å°‘8ä¸ªå­—ç¬¦"
3. å¯†ç ä¸åŒ¹é… â†’ åº”æ˜¾ç¤º"ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´"
4. ç©ºå­—æ®µæäº¤ â†’ åº”æ˜¾ç¤ºå¯¹åº”é”™è¯¯æ¶ˆæ¯

# E2E æµ‹è¯•
npx playwright test tests/e2e/auth.spec.ts -g "form validation"
```

---

### 3.4 Phase 1 æäº¤

```bash
# æäº¤ Phase 1
git add -A
git commit -m "fix: Phase 1 - P0 bug fixes (logout, notifications, form validation)"
git push origin feat/phase1-p0-fixes

# åˆå¹¶åˆ°ä¸»åŠŸèƒ½åˆ†æ”¯
git checkout feat/comprehensive-fixes
git merge feat/phase1-p0-fixes
git push origin feat/comprehensive-fixes

# åˆ›å»º Phase 2 åˆ†æ”¯
git checkout -b feat/phase2-monitoring
```



---

## å››ã€Phase 2: ç›‘æ§ä½“ç³»

> **æ¥æº**: èåˆï¼ˆä¸¤è€…ç›¸ä¼¼ï¼ŒClaude é›†æˆæ›´ç´§å¯†ï¼‰  
> **æ—¶é—´**: 2å¤©  
> **ç›®æ ‡**: å»ºç«‹å®Œæ•´çš„å¯è§‚æµ‹æ€§åŸºç¡€

### 4.1 Sentry é”™è¯¯ç›‘æ§

#### Step 4.1.1: åˆ›å»º Sentry é¡¹ç›®

1. è®¿é—® https://sentry.io/signup/
2. åˆ›å»ºæ–°é¡¹ç›®ï¼Œé€‰æ‹© React
3. è·å– DSN

#### Step 4.1.2: é…ç½® Sentry

```typescript
// src/lib/sentry.ts (æ–°å»º)
import * as Sentry from '@sentry/react';

export function initSentry() {
  if (import.meta.env.PROD) {
    Sentry.init({
      dsn: import.meta.env.VITE_SENTRY_DSN,
      environment: import.meta.env.MODE,
      release: `follow-ai@${import.meta.env.VITE_APP_VERSION}`,
      
      integrations: [
        // æµè§ˆå™¨è¿½è¸ª
        Sentry.browserTracingIntegration(),
        // Session Replay
        Sentry.replayIntegration({
          maskAllText: false,
          blockAllMedia: false,
        }),
        // ç”¨æˆ·åé¦ˆ
        Sentry.feedbackIntegration({
          buttonLabel: 'åé¦ˆé—®é¢˜',
          submitButtonLabel: 'æäº¤',
          formTitle: 'æŠ¥å‘Šé—®é¢˜',
          messagePlaceholder: 'è¯·æè¿°æ‚¨é‡åˆ°çš„é—®é¢˜...',
        }),
      ],

      // æ€§èƒ½ç›‘æ§é‡‡æ ·ç‡
      tracesSampleRate: import.meta.env.PROD ? 0.2 : 1.0,
      
      // Session Replay é‡‡æ ·ç‡
      replaysSessionSampleRate: 0.1,
      replaysOnErrorSampleRate: 1.0,

      // è¿‡æ»¤å™ªéŸ³é”™è¯¯
      ignoreErrors: [
        'ResizeObserver loop limit exceeded',
        'ResizeObserver loop completed with undelivered notifications',
        'Network request failed',
        'Failed to fetch',
        /Loading chunk \d+ failed/,
        /ChunkLoadError/,
      ],

      // å‘é€å‰å¤„ç†
      beforeSend(event, hint) {
        // ç§»é™¤ PII
        if (event.user) {
          delete event.user.email;
          delete event.user.ip_address;
        }
        
        // è¿‡æ»¤ç¬¬ä¸‰æ–¹è„šæœ¬é”™è¯¯
        const frames = event.exception?.values?.[0]?.stacktrace?.frames;
        if (frames?.some(frame => frame.filename?.includes('chrome-extension'))) {
          return null;
        }
        
        return event;
      },

      // å‘é€å‰å¤„ç† breadcrumbs
      beforeBreadcrumb(breadcrumb) {
        // è¿‡æ»¤æ•æ„Ÿ URL
        if (breadcrumb.category === 'navigation') {
          if (breadcrumb.data?.to?.includes('password')) {
            return null;
          }
        }
        return breadcrumb;
      },
    });
  }
}

// è®¾ç½®ç”¨æˆ·ä¸Šä¸‹æ–‡
export function setSentryUser(user: { id: string; username: string } | null) {
  if (user) {
    Sentry.setUser({
      id: user.id,
      username: user.username,
    });
  } else {
    Sentry.setUser(null);
  }
}

// æ‰‹åŠ¨æ•è·é”™è¯¯
export function captureError(error: Error, context?: Record<string, any>) {
  Sentry.captureException(error, {
    extra: context,
  });
}

// æ‰‹åŠ¨æ•è·æ¶ˆæ¯
export function captureMessage(message: string, level: Sentry.SeverityLevel = 'info') {
  Sentry.captureMessage(message, level);
}
```

#### Step 4.1.3: åˆ›å»ºé”™è¯¯è¾¹ç•Œç»„ä»¶

```tsx
// src/components/ErrorFallback.tsx (æ–°å»º)
import { useEffect } from 'react';
import * as Sentry from '@sentry/react';
import { AlertTriangle, RefreshCw, Home } from 'lucide-react';

interface ErrorFallbackProps {
  error: Error;
  resetError: () => void;
}

export function ErrorFallback({ error, resetError }: ErrorFallbackProps) {
  useEffect(() => {
    // é”™è¯¯å·²ç”± Sentry ErrorBoundary è‡ªåŠ¨æ•è·
    console.error('Application error:', error);
  }, [error]);

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-50 p-4">
      <div className="max-w-md w-full bg-white rounded-2xl shadow-xl p-8 text-center">
        <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
          <AlertTriangle className="w-8 h-8 text-red-600" />
        </div>
        
        <h1 className="text-2xl font-bold text-gray-900 mb-2">
          å‡ºé”™äº†
        </h1>
        
        <p className="text-gray-600 mb-6">
          æˆ‘ä»¬å·²è®°å½•æ­¤é”™è¯¯ï¼Œå›¢é˜Ÿå°†å°½å¿«ä¿®å¤ã€‚
        </p>
        
        {import.meta.env.DEV && (
          <pre className="text-left text-sm bg-gray-100 p-4 rounded-lg mb-6 overflow-auto max-h-40">
            <code className="text-red-600">{error.message}</code>
          </pre>
        )}
        
        <div className="flex gap-3 justify-center">
          <button
            onClick={resetError}
            className="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            <RefreshCw className="w-4 h-4" />
            é‡è¯•
          </button>
          
          <a
            href="/"
            className="flex items-center gap-2 px-4 py-2 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition-colors"
          >
            <Home className="w-4 h-4" />
            è¿”å›é¦–é¡µ
          </a>
        </div>
        
        <button
          onClick={() => Sentry.showReportDialog()}
          className="mt-6 text-sm text-gray-500 hover:text-gray-700"
        >
          æŠ¥å‘Šæ­¤é—®é¢˜
        </button>
      </div>
    </div>
  );
}
```

#### Step 4.1.4: åˆå§‹åŒ– Sentry

```typescript
// src/main.tsx (ä¿®æ”¹)
import React from 'react';
import ReactDOM from 'react-dom/client';
import * as Sentry from '@sentry/react';
import { RouterProvider } from 'react-router-dom';
import { QueryClientProvider } from '@tanstack/react-query';
import { initSentry } from './lib/sentry';
import { queryClient } from './lib/react-query';
import { router } from './router';
import { ErrorFallback } from './components/ErrorFallback';
import './index.css';

// åˆå§‹åŒ– Sentryï¼ˆæœ€å…ˆæ‰§è¡Œï¼‰
initSentry();

ReactDOM.createRoot(document.getElementById('root')!).render(
  <React.StrictMode>
    <Sentry.ErrorBoundary
      fallback={({ error, resetError }) => (
        <ErrorFallback error={error} resetError={resetError} />
      )}
      showDialog
    >
      <QueryClientProvider client={queryClient}>
        <RouterProvider router={router} />
      </QueryClientProvider>
    </Sentry.ErrorBoundary>
  </React.StrictMode>
);
```

---

### 4.2 PostHog äº§å“åˆ†æ

#### Step 4.2.1: åˆ›å»º PostHog é¡¹ç›®

1. è®¿é—® https://posthog.com/signup
2. åˆ›å»ºæ–°é¡¹ç›®
3. è·å– API Key

#### Step 4.2.2: é…ç½® PostHog

```typescript
// src/lib/posthog.ts (æ–°å»º)
import posthog from 'posthog-js';

export function initPostHog() {
  if (import.meta.env.PROD && import.meta.env.VITE_POSTHOG_KEY) {
    posthog.init(import.meta.env.VITE_POSTHOG_KEY, {
      api_host: import.meta.env.VITE_POSTHOG_HOST || 'https://app.posthog.com',
      
      // è‡ªåŠ¨æ•è·
      autocapture: true,
      capture_pageview: true,
      capture_pageleave: true,
      
      // æŒä¹…åŒ–
      persistence: 'localStorage',
      
      // éšç§è®¾ç½®
      mask_all_text: false,
      mask_all_element_attributes: false,
      
      // Session Recording
      disable_session_recording: false,
      session_recording: {
        maskAllInputs: true,
        maskInputOptions: {
          password: true,
        },
      },
      
      // Feature Flags
      bootstrap: {
        featureFlags: {
          'new-dashboard': false,
          'ai-review-v2': false,
          'success-score': true,
        },
      },
      
      // åŠ è½½å®Œæˆå›è°ƒ
      loaded: (posthog) => {
        if (import.meta.env.DEV) {
          posthog.debug();
        }
      },
    });
  }
}

// è®¾ç½®ç”¨æˆ·èº«ä»½
export function identifyUser(userId: string, properties?: Record<string, any>) {
  posthog.identify(userId, properties);
}

// é‡ç½®ç”¨æˆ·èº«ä»½ï¼ˆç™»å‡ºæ—¶è°ƒç”¨ï¼‰
export function resetUser() {
  posthog.reset();
}

// äº‹ä»¶è¿½è¸ªå°è£…
export const analytics = {
  // ä»»åŠ¡ç›¸å…³
  taskViewed: (taskId: string, taskType: string) => {
    posthog.capture('task_viewed', { task_id: taskId, task_type: taskType });
  },
  
  taskStarted: (taskId: string, taskType: string) => {
    posthog.capture('task_started', { task_id: taskId, task_type: taskType });
  },
  
  taskSubmitted: (taskId: string, taskType: string) => {
    posthog.capture('task_submitted', { task_id: taskId, task_type: taskType });
  },
  
  taskApproved: (taskId: string, score: number) => {
    posthog.capture('task_approved', { task_id: taskId, quality_score: score });
  },
  
  taskRejected: (taskId: string, reason: string) => {
    posthog.capture('task_rejected', { task_id: taskId, reason });
  },
  
  // XP å’Œç­‰çº§
  xpEarned: (amount: number, source: string) => {
    posthog.capture('xp_earned', { amount, source });
  },
  
  levelUp: (newLevel: number, newTitle: string) => {
    posthog.capture('level_up', { new_level: newLevel, new_title: newTitle });
  },
  
  // å¾½ç« 
  badgeEarned: (badgeId: string, badgeName: string) => {
    posthog.capture('badge_earned', { badge_id: badgeId, badge_name: badgeName });
  },
  
  // è®¤è¯
  signUpStarted: () => {
    posthog.capture('signup_started');
  },
  
  signUpCompleted: () => {
    posthog.capture('signup_completed');
  },
  
  loginCompleted: () => {
    posthog.capture('login_completed');
  },
  
  logoutCompleted: () => {
    posthog.capture('logout_completed');
  },
  
  // é¡µé¢äº¤äº’
  featureUsed: (featureName: string, metadata?: Record<string, any>) => {
    posthog.capture('feature_used', { feature: featureName, ...metadata });
  },
  
  // é”™è¯¯
  errorOccurred: (errorType: string, errorMessage: string) => {
    posthog.capture('error_occurred', { error_type: errorType, error_message: errorMessage });
  },
};

// Feature Flag Hook
export function useFeatureFlag(flagKey: string): boolean {
  return posthog.isFeatureEnabled(flagKey) ?? false;
}

// A/B æµ‹è¯• Hook
export function useExperiment(experimentKey: string): string | undefined {
  return posthog.getFeatureFlag(experimentKey) as string | undefined;
}
```

#### Step 4.2.3: åˆå§‹åŒ– PostHog

```typescript
// src/main.tsx (æ·»åŠ )
import { initPostHog } from './lib/posthog';

// åˆå§‹åŒ–é¡ºåºï¼šSentry -> PostHog
initSentry();
initPostHog();
```

---

### 4.3 Core Web Vitals ç›‘æ§

```typescript
// src/lib/web-vitals.ts (æ–°å»º)
import { onLCP, onINP, onCLS, onFCP, onTTFB, type Metric } from 'web-vitals/attribution';
import * as Sentry from '@sentry/react';
import posthog from 'posthog-js';

// 2025 å¹´ Core Web Vitals é˜ˆå€¼
const THRESHOLDS = {
  LCP: { good: 2500, poor: 4000 },   // Largest Contentful Paint
  INP: { good: 200, poor: 500 },     // Interaction to Next Paint
  CLS: { good: 0.1, poor: 0.25 },    // Cumulative Layout Shift
  FCP: { good: 1800, poor: 3000 },   // First Contentful Paint
  TTFB: { good: 800, poor: 1800 },   // Time to First Byte
};

function getRating(name: string, value: number): 'good' | 'needs-improvement' | 'poor' {
  const threshold = THRESHOLDS[name as keyof typeof THRESHOLDS];
  if (!threshold) return 'needs-improvement';
  
  if (value <= threshold.good) return 'good';
  if (value <= threshold.poor) return 'needs-improvement';
  return 'poor';
}

function sendMetric(metric: Metric) {
  const rating = getRating(metric.name, metric.value);
  
  // å‘é€åˆ° PostHog
  if (import.meta.env.PROD) {
    posthog.capture('web_vitals', {
      name: metric.name,
      value: Math.round(metric.value),
      rating,
      navigationType: metric.navigationType,
      // Attribution æ•°æ®ï¼ˆç”¨äºè°ƒè¯•ï¼‰
      ...(metric.attribution && {
        attribution: JSON.stringify(metric.attribution),
      }),
    });
  }

  // æ€§èƒ½é—®é¢˜å‘Šè­¦åˆ° Sentry
  if (rating === 'poor') {
    Sentry.captureMessage(`Performance regression: ${metric.name}`, {
      level: 'warning',
      tags: {
        metric: metric.name,
        rating,
      },
      extra: {
        value: metric.value,
        threshold: THRESHOLDS[metric.name as keyof typeof THRESHOLDS],
        attribution: metric.attribution,
        navigationType: metric.navigationType,
      },
    });
  }

  // å¼€å‘ç¯å¢ƒæ—¥å¿—
  if (import.meta.env.DEV) {
    console.log(`[Web Vitals] ${metric.name}:`, {
      value: Math.round(metric.value),
      rating,
      threshold: THRESHOLDS[metric.name as keyof typeof THRESHOLDS],
    });
  }
}

export function initWebVitals() {
  // æ ¸å¿ƒæŒ‡æ ‡
  onLCP(sendMetric);
  onINP(sendMetric);
  onCLS(sendMetric);
  
  // è¾…åŠ©æŒ‡æ ‡
  onFCP(sendMetric);
  onTTFB(sendMetric);
}
```

#### Step 4.3.1: åˆå§‹åŒ– Web Vitals

```typescript
// src/main.tsx (æ·»åŠ )
import { initWebVitals } from './lib/web-vitals';

// åˆå§‹åŒ–é¡ºåºï¼šSentry -> PostHog -> Web Vitals
initSentry();
initPostHog();
initWebVitals();
```

---

### 4.4 Phase 2 éªŒè¯å’Œæäº¤

```bash
# éªŒè¯ Sentry
1. æ·»åŠ  DSN åˆ° .env.local
2. pnpm build && pnpm preview
3. åœ¨æ§åˆ¶å°æ‰§è¡Œ: throw new Error('Test Sentry')
4. æ£€æŸ¥ Sentry Dashboard

# éªŒè¯ PostHog
1. æ·»åŠ  Key åˆ° .env.local
2. pnpm dev
3. æ‰§è¡Œæ“ä½œï¼ˆç™»å½•ã€æŸ¥çœ‹ä»»åŠ¡ç­‰ï¼‰
4. æ£€æŸ¥ PostHog Events

# éªŒè¯ Web Vitals
1. æ‰“å¼€å¼€å‘è€…å·¥å…· Console
2. åˆ·æ–°é¡µé¢
3. æŸ¥çœ‹ [Web Vitals] æ—¥å¿—

# æäº¤
git add -A
git commit -m "feat: Phase 2 - Monitoring system (Sentry, PostHog, Web Vitals)"
git push origin feat/phase2-monitoring
```

---

## äº”ã€Phase 3: æ€§èƒ½ä¼˜åŒ–

> **æ¥æº**: Claude æ–¹æ¡ˆï¼ˆå«å›¾ç‰‡ä¼˜åŒ–ï¼‰  
> **æ—¶é—´**: 2å¤©  
> **ç›®æ ‡**: æå‡ç”¨æˆ·ä½“éªŒï¼Œä¼˜åŒ–åŠ è½½é€Ÿåº¦

### 5.1 Vite é…ç½®ä¼˜åŒ–

```typescript
// vite.config.ts (é‡æ„)
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react-swc';
import { compression } from 'vite-plugin-compression';
import { visualizer } from 'rollup-plugin-visualizer';
import { ViteImageOptimizer } from 'vite-plugin-image-optimizer';
import path from 'path';

export default defineConfig({
  plugins: [
    react(),
    
    // Brotli å‹ç¼©
    compression({
      algorithm: 'brotliCompress',
      ext: '.br',
    }),
    
    // Gzip å‹ç¼©ï¼ˆå…¼å®¹æ€§ï¼‰
    compression({
      algorithm: 'gzip',
      ext: '.gz',
    }),
    
    // å›¾ç‰‡ä¼˜åŒ–
    ViteImageOptimizer({
      test: /\.(jpe?g|png|gif|webp|svg)$/i,
      includePublic: true,
      logStats: true,
      png: {
        quality: 80,
      },
      jpeg: {
        quality: 80,
      },
      webp: {
        quality: 80,
      },
    }),
    
    // Bundle åˆ†æï¼ˆä»…æ„å»ºæ—¶ï¼‰
    visualizer({
      open: false,
      filename: 'dist/stats.html',
      gzipSize: true,
      brotliSize: true,
    }),
  ],
  
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
  
  build: {
    target: 'esnext',
    minify: 'esbuild',
    sourcemap: true,
    
    rollupOptions: {
      output: {
        // æ‰‹åŠ¨åˆ†å‰² chunks
        manualChunks: (id) => {
          if (id.includes('node_modules')) {
            // React æ ¸å¿ƒ
            if (id.includes('react') || id.includes('react-dom') || id.includes('react-router')) {
              return 'react-vendor';
            }
            // Supabase
            if (id.includes('@supabase')) {
              return 'supabase-vendor';
            }
            // UI åº“
            if (id.includes('framer-motion') || id.includes('lucide-react')) {
              return 'ui-vendor';
            }
            // ç›‘æ§
            if (id.includes('@sentry') || id.includes('posthog')) {
              return 'monitoring-vendor';
            }
            // è¡¨å•
            if (id.includes('react-hook-form') || id.includes('zod') || id.includes('@hookform')) {
              return 'form-vendor';
            }
            // å·¥å…·åº“
            if (id.includes('date-fns') || id.includes('lodash')) {
              return 'utils-vendor';
            }
            // å…¶ä»–ç¬¬ä¸‰æ–¹åº“
            return 'vendor';
          }
        },
      },
    },
    
    // Chunk å¤§å°è­¦å‘Šé˜ˆå€¼
    chunkSizeWarningLimit: 300,
  },
  
  // å¼€å‘æœåŠ¡å™¨ä¼˜åŒ–
  server: {
    hmr: {
      overlay: true,
    },
  },
  
  // é¢„æ„å»ºä¼˜åŒ–
  optimizeDeps: {
    include: [
      'react',
      'react-dom',
      'react-router-dom',
      '@supabase/supabase-js',
      'framer-motion',
      'lucide-react',
    ],
  },
});
```

---

### 5.2 è·¯ç”±æ‡’åŠ è½½

```typescript
// src/router.tsx (é‡æ„)
import { lazy, Suspense } from 'react';
import { createBrowserRouter, Outlet } from 'react-router-dom';
import { Layout } from './components/Layout';
import { ProtectedRoute } from './components/ProtectedRoute';
import { PageLoader } from './components/PageLoader';

// é¦–é¡µä¸æ‡’åŠ è½½ï¼ˆé¦–å±ï¼‰
import Home from './pages/Home';

// æ‡’åŠ è½½å…¶ä»–é¡µé¢
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Tasks = lazy(() => import('./pages/Tasks'));
const TaskDetail = lazy(() => import('./pages/TaskDetail'));
const TaskSubmit = lazy(() => import('./pages/TaskSubmit'));
const Profile = lazy(() => import('./pages/Profile'));
const Settings = lazy(() => import('./pages/Settings'));
const Leaderboard = lazy(() => import('./pages/Leaderboard'));
const Wallet = lazy(() => import('./pages/Wallet'));
const NotFound = lazy(() => import('./pages/NotFound'));

// Admin é¡µé¢ï¼ˆç‹¬ç«‹ chunkï¼‰
const AdminDashboard = lazy(() => import('./pages/admin/Dashboard'));
const AdminUsers = lazy(() => import('./pages/admin/Users'));
const AdminTasks = lazy(() => import('./pages/admin/Tasks'));
const AdminSubmissions = lazy(() => import('./pages/admin/Submissions'));

// æ‡’åŠ è½½åŒ…è£…å™¨
function LazyPage({ children }: { children: React.ReactNode }) {
  return (
    <Suspense fallback={<PageLoader />}>
      {children}
    </Suspense>
  );
}

export const router = createBrowserRouter([
  {
    path: '/',
    element: <Layout />,
    children: [
      // å…¬å¼€é¡µé¢
      {
        index: true,
        element: <Home />,
      },
      {
        path: 'tasks',
        element: (
          <LazyPage>
            <Tasks />
          </LazyPage>
        ),
      },
      {
        path: 'tasks/:id',
        element: (
          <LazyPage>
            <TaskDetail />
          </LazyPage>
        ),
      },
      {
        path: 'leaderboard',
        element: (
          <LazyPage>
            <Leaderboard />
          </LazyPage>
        ),
      },
      
      // éœ€è¦è®¤è¯çš„é¡µé¢
      {
        path: 'dashboard',
        element: (
          <ProtectedRoute>
            <LazyPage>
              <Dashboard />
            </LazyPage>
          </ProtectedRoute>
        ),
      },
      {
        path: 'tasks/:id/submit',
        element: (
          <ProtectedRoute>
            <LazyPage>
              <TaskSubmit />
            </LazyPage>
          </ProtectedRoute>
        ),
      },
      {
        path: 'profile',
        element: (
          <ProtectedRoute>
            <LazyPage>
              <Profile />
            </LazyPage>
          </ProtectedRoute>
        ),
      },
      {
        path: 'settings',
        element: (
          <ProtectedRoute>
            <LazyPage>
              <Settings />
            </LazyPage>
          </ProtectedRoute>
        ),
      },
      {
        path: 'wallet',
        element: (
          <ProtectedRoute>
            <LazyPage>
              <Wallet />
            </LazyPage>
          </ProtectedRoute>
        ),
      },
      
      // Admin è·¯ç”±
      {
        path: 'admin',
        element: (
          <ProtectedRoute requireAdmin>
            <Outlet />
          </ProtectedRoute>
        ),
        children: [
          {
            index: true,
            element: (
              <LazyPage>
                <AdminDashboard />
              </LazyPage>
            ),
          },
          {
            path: 'users',
            element: (
              <LazyPage>
                <AdminUsers />
              </LazyPage>
            ),
          },
          {
            path: 'tasks',
            element: (
              <LazyPage>
                <AdminTasks />
              </LazyPage>
            ),
          },
          {
            path: 'submissions',
            element: (
              <LazyPage>
                <AdminSubmissions />
              </LazyPage>
            ),
          },
        ],
      },
      
      // 404
      {
        path: '*',
        element: (
          <LazyPage>
            <NotFound />
          </LazyPage>
        ),
      },
    ],
  },
]);
```

---

### 5.3 é¡µé¢åŠ è½½ç»„ä»¶

```tsx
// src/components/PageLoader.tsx (æ–°å»º)
import { motion } from 'framer-motion';

export function PageLoader() {
  return (
    <div className="min-h-[60vh] flex items-center justify-center">
      <motion.div
        className="flex flex-col items-center gap-4"
        initial={{ opacity: 0 }}
        animate={{ opacity: 1 }}
        transition={{ duration: 0.3 }}
      >
        <div className="relative w-16 h-16">
          <motion.div
            className="absolute inset-0 border-4 border-blue-200 rounded-full"
            animate={{ rotate: 360 }}
            transition={{ duration: 1, repeat: Infinity, ease: 'linear' }}
          />
          <motion.div
            className="absolute inset-0 border-4 border-transparent border-t-blue-600 rounded-full"
            animate={{ rotate: 360 }}
            transition={{ duration: 0.8, repeat: Infinity, ease: 'linear' }}
          />
        </div>
        <p className="text-gray-500 text-sm">åŠ è½½ä¸­...</p>
      </motion.div>
    </div>
  );
}
```

---

### 5.4 éª¨æ¶å±ç»„ä»¶

```tsx
// src/components/Skeleton.tsx (æ–°å»º)
import { cn } from '@/lib/utils';

interface SkeletonProps {
  className?: string;
  variant?: 'text' | 'circular' | 'rectangular';
  width?: string | number;
  height?: string | number;
  animation?: 'pulse' | 'wave' | 'none';
}

export function Skeleton({
  className,
  variant = 'rectangular',
  width,
  height,
  animation = 'pulse',
}: SkeletonProps) {
  const baseStyles = 'bg-gray-200';
  
  const variantStyles = {
    text: 'rounded',
    circular: 'rounded-full',
    rectangular: 'rounded-lg',
  };
  
  const animationStyles = {
    pulse: 'animate-pulse',
    wave: 'animate-shimmer bg-gradient-to-r from-gray-200 via-gray-100 to-gray-200 bg-[length:200%_100%]',
    none: '',
  };

  return (
    <div
      className={cn(
        baseStyles,
        variantStyles[variant],
        animationStyles[animation],
        className
      )}
      style={{
        width: typeof width === 'number' ? `${width}px` : width,
        height: typeof height === 'number' ? `${height}px` : height,
      }}
    />
  );
}

// é¢„è®¾éª¨æ¶å±
export function CardSkeleton() {
  return (
    <div className="bg-white rounded-xl p-6 shadow-sm">
      <Skeleton className="h-6 w-1/3 mb-4" />
      <Skeleton className="h-4 w-full mb-2" />
      <Skeleton className="h-4 w-2/3 mb-4" />
      <div className="flex gap-2">
        <Skeleton className="h-8 w-20" />
        <Skeleton className="h-8 w-20" />
      </div>
    </div>
  );
}

export function TaskCardSkeleton() {
  return (
    <div className="bg-white rounded-xl p-6 shadow-sm">
      <div className="flex items-start gap-4">
        <Skeleton variant="circular" width={48} height={48} />
        <div className="flex-1">
          <Skeleton className="h-5 w-2/3 mb-2" />
          <Skeleton className="h-4 w-full mb-1" />
          <Skeleton className="h-4 w-3/4" />
        </div>
      </div>
      <div className="flex items-center justify-between mt-4 pt-4 border-t">
        <Skeleton className="h-6 w-24" />
        <Skeleton className="h-9 w-28" />
      </div>
    </div>
  );
}

export function ProfileSkeleton() {
  return (
    <div className="bg-white rounded-xl p-8 shadow-sm">
      <div className="flex items-center gap-6 mb-6">
        <Skeleton variant="circular" width={96} height={96} />
        <div>
          <Skeleton className="h-8 w-48 mb-2" />
          <Skeleton className="h-4 w-32" />
        </div>
      </div>
      <div className="grid grid-cols-3 gap-4">
        <Skeleton className="h-24" />
        <Skeleton className="h-24" />
        <Skeleton className="h-24" />
      </div>
    </div>
  );
}
```

---

### 5.5 ä¼˜åŒ–å›¾ç‰‡ç»„ä»¶

```tsx
// src/components/OptimizedImage.tsx (æ–°å»º)
import { useState, useEffect, useRef } from 'react';
import { cn } from '@/lib/utils';

interface OptimizedImageProps {
  src: string;
  alt: string;
  width: number;
  height: number;
  className?: string;
  priority?: boolean;
  placeholder?: 'blur' | 'empty';
  blurDataURL?: string;
  onLoad?: () => void;
  onError?: () => void;
}

export function OptimizedImage({
  src,
  alt,
  width,
  height,
  className,
  priority = false,
  placeholder = 'empty',
  blurDataURL,
  onLoad,
  onError,
}: OptimizedImageProps) {
  const [isLoaded, setIsLoaded] = useState(false);
  const [hasError, setHasError] = useState(false);
  const imgRef = useRef<HTMLImageElement>(null);

  useEffect(() => {
    if (priority && imgRef.current) {
      imgRef.current.loading = 'eager';
    }
  }, [priority]);

  const handleLoad = () => {
    setIsLoaded(true);
    onLoad?.();
  };

  const handleError = () => {
    setHasError(true);
    onError?.();
  };

  return (
    <div
      className={cn('relative overflow-hidden', className)}
      style={{ aspectRatio: `${width} / ${height}` }}
    >
      {/* å ä½ç¬¦ */}
      {placeholder === 'blur' && blurDataURL && !isLoaded && (
        <img
          src={blurDataURL}
          alt=""
          className="absolute inset-0 w-full h-full object-cover filter blur-lg scale-110"
          aria-hidden="true"
        />
      )}
      
      {/* ç©ºå ä½ç¬¦ */}
      {placeholder === 'empty' && !isLoaded && !hasError && (
        <div className="absolute inset-0 bg-gray-200 animate-pulse" />
      )}
      
      {/* å®é™…å›¾ç‰‡ */}
      <img
        ref={imgRef}
        src={src}
        alt={alt}
        width={width}
        height={height}
        loading={priority ? 'eager' : 'lazy'}
        decoding="async"
        onLoad={handleLoad}
        onError={handleError}
        className={cn(
          'w-full h-full object-cover transition-opacity duration-300',
          isLoaded ? 'opacity-100' : 'opacity-0',
          hasError && 'hidden'
        )}
      />
      
      {/* é”™è¯¯çŠ¶æ€ */}
      {hasError && (
        <div className="absolute inset-0 bg-gray-100 flex items-center justify-center">
          <span className="text-gray-400 text-sm">å›¾ç‰‡åŠ è½½å¤±è´¥</span>
        </div>
      )}
    </div>
  );
}
```

---

### 5.6 Phase 3 éªŒè¯å’Œæäº¤

```bash
# æ„å»ºå¹¶åˆ†æ
pnpm build

# æŸ¥çœ‹ Bundle åˆ†æ
open dist/stats.html

# éªŒè¯ Chunk åˆ†å‰²
ls -la dist/assets/
# åº”è¯¥çœ‹åˆ°å¤šä¸ª vendor chunk æ–‡ä»¶

# éªŒè¯æ‡’åŠ è½½
pnpm preview
# æ‰“å¼€ Network æ ‡ç­¾ï¼Œå¯¼èˆªåˆ°ä¸åŒé¡µé¢
# åº”è¯¥çœ‹åˆ°æŒ‰éœ€åŠ è½½çš„ JS æ–‡ä»¶

# Lighthouse æµ‹è¯•
npx lighthouse http://localhost:4173 --output html --output-path ./lighthouse-report.html
# ç›®æ ‡ï¼šPerformance â‰¥ 90

# æäº¤
git add -A
git commit -m "perf: Phase 3 - Performance optimization (code splitting, lazy loading, image optimization)"
git push origin feat/phase3-performance
```



---

## å…­ã€Phase 4: Admin + AI Review

> **æ¥æº**: Claude æ–¹æ¡ˆï¼ˆSQL æ›´å®Œæ•´ï¼‰  
> **æ—¶é—´**: 4å¤©  
> **ç›®æ ‡**: å»ºç«‹è¿è¥ç®¡ç†èƒ½åŠ›

### 6.1 æ•°æ®åº“è¿ç§» - ç®¡ç†å‘˜è§’è‰²ç³»ç»Ÿ

```sql
-- migrations/20260108_admin_roles.sql

-- 1. æ·»åŠ ç®¡ç†å‘˜è§’è‰²åˆ° profiles è¡¨
ALTER TABLE profiles 
ADD COLUMN IF NOT EXISTS role VARCHAR(20) DEFAULT 'user' CHECK (role IN ('user', 'reviewer', 'admin', 'super_admin'));

-- 2. åˆ›å»ºå®¡è®¡æ—¥å¿—è¡¨
CREATE TABLE IF NOT EXISTS admin_audit_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  admin_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  action VARCHAR(50) NOT NULL,
  target_type VARCHAR(50) NOT NULL,
  target_id UUID,
  old_value JSONB,
  new_value JSONB,
  ip_address INET,
  user_agent TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 3. åˆ›å»ºç´¢å¼•
CREATE INDEX idx_audit_logs_admin_id ON admin_audit_logs(admin_id);
CREATE INDEX idx_audit_logs_action ON admin_audit_logs(action);
CREATE INDEX idx_audit_logs_target ON admin_audit_logs(target_type, target_id);
CREATE INDEX idx_audit_logs_created_at ON admin_audit_logs(created_at DESC);
CREATE INDEX idx_profiles_role ON profiles(role);

-- 4. RLS ç­–ç•¥
ALTER TABLE admin_audit_logs ENABLE ROW LEVEL SECURITY;

-- åªæœ‰ç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹å®¡è®¡æ—¥å¿—
CREATE POLICY "Admins can view audit logs"
  ON admin_audit_logs FOR SELECT
  TO authenticated
  USING (
    EXISTS (
      SELECT 1 FROM profiles 
      WHERE profiles.id = auth.uid() 
      AND profiles.role IN ('admin', 'super_admin')
    )
  );

-- åªæœ‰ç³»ç»Ÿå¯ä»¥æ’å…¥å®¡è®¡æ—¥å¿—
CREATE POLICY "System can insert audit logs"
  ON admin_audit_logs FOR INSERT
  TO authenticated
  WITH CHECK (admin_id = auth.uid());

-- 5. å®¡è®¡æ—¥å¿—è§¦å‘å™¨å‡½æ•°
CREATE OR REPLACE FUNCTION log_admin_action()
RETURNS TRIGGER AS $$
BEGIN
  INSERT INTO admin_audit_logs (
    admin_id,
    action,
    target_type,
    target_id,
    old_value,
    new_value
  ) VALUES (
    auth.uid(),
    TG_ARGV[0],
    TG_TABLE_NAME,
    COALESCE(NEW.id, OLD.id),
    CASE WHEN TG_OP IN ('UPDATE', 'DELETE') THEN to_jsonb(OLD) ELSE NULL END,
    CASE WHEN TG_OP IN ('INSERT', 'UPDATE') THEN to_jsonb(NEW) ELSE NULL END
  );
  RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- 6. ä¸ºå…³é”®è¡¨æ·»åŠ å®¡è®¡è§¦å‘å™¨
CREATE TRIGGER audit_task_submissions
  AFTER UPDATE ON task_submissions
  FOR EACH ROW
  EXECUTE FUNCTION log_admin_action('review_submission');

-- 7. ç®¡ç†å‘˜ç»Ÿè®¡è§†å›¾
CREATE OR REPLACE VIEW admin_dashboard_stats AS
SELECT
  (SELECT COUNT(*) FROM profiles WHERE created_at > NOW() - INTERVAL '24 hours') AS new_users_24h,
  (SELECT COUNT(*) FROM profiles WHERE created_at > NOW() - INTERVAL '7 days') AS new_users_7d,
  (SELECT COUNT(*) FROM task_submissions WHERE status = 'pending') AS pending_reviews,
  (SELECT COUNT(*) FROM task_submissions WHERE reviewed_at > NOW() - INTERVAL '24 hours') AS reviews_24h,
  (SELECT COUNT(*) FROM tasks WHERE is_active = true) AS active_tasks,
  (SELECT COALESCE(SUM(xp), 0) FROM xp_events WHERE created_at > NOW() - INTERVAL '24 hours') AS xp_distributed_24h,
  (SELECT COUNT(*) FROM profiles WHERE role IN ('reviewer', 'admin', 'super_admin')) AS admin_count;

-- 8. è®¾ç½®åˆå§‹è¶…çº§ç®¡ç†å‘˜ï¼ˆæ›¿æ¢ä¸ºå®é™…ç”¨æˆ· IDï¼‰
-- UPDATE profiles SET role = 'super_admin' WHERE id = 'YOUR_USER_ID';
```

#### Step 6.1.1: æ‰§è¡Œè¿ç§»

```bash
# åœ¨ Supabase SQL Editor ä¸­æ‰§è¡Œä¸Šè¿° SQL
# æˆ–ä½¿ç”¨ Supabase CLI
supabase db push
```

---

### 6.2 Admin Dashboard é¡µé¢

```tsx
// src/pages/admin/Dashboard.tsx (æ–°å»º)
import { useState, useEffect } from 'react';
import { 
  Users, 
  FileCheck, 
  Clock, 
  TrendingUp, 
  Activity,
  AlertTriangle,
  CheckCircle,
  XCircle,
  RefreshCw
} from 'lucide-react';
import { supabase } from '@/lib/supabase';
import { Skeleton } from '@/components/Skeleton';
import { formatDistanceToNow } from 'date-fns';
import { zhCN } from 'date-fns/locale';

interface DashboardStats {
  new_users_24h: number;
  new_users_7d: number;
  pending_reviews: number;
  reviews_24h: number;
  active_tasks: number;
  xp_distributed_24h: number;
  admin_count: number;
}

interface PendingSubmission {
  id: string;
  task_title: string;
  user_name: string;
  submitted_at: string;
  priority: 'low' | 'medium' | 'high';
}

interface RecentActivity {
  id: string;
  action: string;
  admin_name: string;
  target_type: string;
  created_at: string;
}

export default function AdminDashboard() {
  const [stats, setStats] = useState<DashboardStats | null>(null);
  const [pendingSubmissions, setPendingSubmissions] = useState<PendingSubmission[]>([]);
  const [recentActivity, setRecentActivity] = useState<RecentActivity[]>([]);
  const [loading, setLoading] = useState(true);
  const [refreshing, setRefreshing] = useState(false);

  const fetchData = async () => {
    try {
      // è·å–ç»Ÿè®¡æ•°æ®
      const { data: statsData } = await supabase
        .from('admin_dashboard_stats')
        .select('*')
        .single();
      
      if (statsData) setStats(statsData);

      // è·å–å¾…å®¡æ ¸æäº¤
      const { data: submissions } = await supabase
        .from('task_submissions')
        .select(`
          id,
          submitted_at,
          tasks(title),
          profiles(username)
        `)
        .eq('status', 'pending')
        .order('submitted_at', { ascending: true })
        .limit(10);

      if (submissions) {
        setPendingSubmissions(submissions.map(s => ({
          id: s.id,
          task_title: s.tasks?.title || 'Unknown',
          user_name: s.profiles?.username || 'Unknown',
          submitted_at: s.submitted_at,
          priority: getPriority(s.submitted_at),
        })));
      }

      // è·å–æœ€è¿‘æ´»åŠ¨
      const { data: activity } = await supabase
        .from('admin_audit_logs')
        .select(`
          id,
          action,
          target_type,
          created_at,
          profiles(username)
        `)
        .order('created_at', { ascending: false })
        .limit(10);

      if (activity) {
        setRecentActivity(activity.map(a => ({
          id: a.id,
          action: a.action,
          admin_name: a.profiles?.username || 'System',
          target_type: a.target_type,
          created_at: a.created_at,
        })));
      }
    } catch (error) {
      console.error('Failed to fetch admin data:', error);
    } finally {
      setLoading(false);
      setRefreshing(false);
    }
  };

  useEffect(() => {
    fetchData();
    
    // æ¯åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°
    const interval = setInterval(fetchData, 60000);
    return () => clearInterval(interval);
  }, []);

  const handleRefresh = () => {
    setRefreshing(true);
    fetchData();
  };

  const getPriority = (submittedAt: string): 'low' | 'medium' | 'high' => {
    const hours = (Date.now() - new Date(submittedAt).getTime()) / (1000 * 60 * 60);
    if (hours > 48) return 'high';
    if (hours > 24) return 'medium';
    return 'low';
  };

  const getPriorityColor = (priority: string) => {
    switch (priority) {
      case 'high': return 'text-red-600 bg-red-50';
      case 'medium': return 'text-yellow-600 bg-yellow-50';
      default: return 'text-green-600 bg-green-50';
    }
  };

  if (loading) {
    return (
      <div className="p-6 space-y-6">
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          {[...Array(4)].map((_, i) => (
            <Skeleton key={i} className="h-32" />
          ))}
        </div>
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <Skeleton className="h-96" />
          <Skeleton className="h-96" />
        </div>
      </div>
    );
  }

  return (
    <div className="p-6 space-y-6">
      {/* å¤´éƒ¨ */}
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold text-gray-900">ç®¡ç†æ§åˆ¶å°</h1>
          <p className="text-gray-500 mt-1">å®æ—¶ç›‘æ§å¹³å°è¿è¥çŠ¶æ€</p>
        </div>
        <button
          onClick={handleRefresh}
          disabled={refreshing}
          className="flex items-center gap-2 px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 disabled:opacity-50"
        >
          <RefreshCw className={`w-4 h-4 ${refreshing ? 'animate-spin' : ''}`} />
          åˆ·æ–°
        </button>
      </div>

      {/* ç»Ÿè®¡å¡ç‰‡ */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <StatCard
          title="å¾…å®¡æ ¸"
          value={stats?.pending_reviews || 0}
          icon={<Clock className="w-6 h-6" />}
          color="yellow"
          trend={stats?.pending_reviews > 10 ? 'up' : 'stable'}
        />
        <StatCard
          title="ä»Šæ—¥å®¡æ ¸"
          value={stats?.reviews_24h || 0}
          icon={<FileCheck className="w-6 h-6" />}
          color="green"
        />
        <StatCard
          title="æ–°ç”¨æˆ· (7å¤©)"
          value={stats?.new_users_7d || 0}
          icon={<Users className="w-6 h-6" />}
          color="blue"
        />
        <StatCard
          title="ä»Šæ—¥ XP å‘æ”¾"
          value={stats?.xp_distributed_24h || 0}
          icon={<TrendingUp className="w-6 h-6" />}
          color="purple"
          format="xp"
        />
      </div>

      {/* ä¸»è¦å†…å®¹ */}
      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
        {/* å¾…å®¡æ ¸é˜Ÿåˆ— */}
        <div className="bg-white rounded-xl shadow-sm border border-gray-100">
          <div className="p-4 border-b border-gray-100 flex items-center justify-between">
            <h2 className="font-semibold text-gray-900 flex items-center gap-2">
              <AlertTriangle className="w-5 h-5 text-yellow-500" />
              å¾…å®¡æ ¸é˜Ÿåˆ—
            </h2>
            <span className="text-sm text-gray-500">
              {pendingSubmissions.length} é¡¹å¾…å¤„ç†
            </span>
          </div>
          <div className="divide-y divide-gray-100 max-h-96 overflow-y-auto">
            {pendingSubmissions.length === 0 ? (
              <div className="p-8 text-center text-gray-500">
                <CheckCircle className="w-12 h-12 mx-auto mb-3 text-green-500" />
                <p>æ‰€æœ‰æäº¤å·²å®¡æ ¸å®Œæ¯•</p>
              </div>
            ) : (
              pendingSubmissions.map(submission => (
                <div key={submission.id} className="p-4 hover:bg-gray-50">
                  <div className="flex items-center justify-between">
                    <div>
                      <p className="font-medium text-gray-900">{submission.task_title}</p>
                      <p className="text-sm text-gray-500">
                        {submission.user_name} Â· {formatDistanceToNow(new Date(submission.submitted_at), { addSuffix: true, locale: zhCN })}
                      </p>
                    </div>
                    <div className="flex items-center gap-2">
                      <span className={`px-2 py-1 text-xs font-medium rounded-full ${getPriorityColor(submission.priority)}`}>
                        {submission.priority === 'high' ? 'ç´§æ€¥' : submission.priority === 'medium' ? 'ä¸­ç­‰' : 'æ­£å¸¸'}
                      </span>
                      <a
                        href={`/admin/submissions/${submission.id}`}
                        className="px-3 py-1 text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700"
                      >
                        å®¡æ ¸
                      </a>
                    </div>
                  </div>
                </div>
              ))
            )}
          </div>
        </div>

        {/* æœ€è¿‘æ´»åŠ¨ */}
        <div className="bg-white rounded-xl shadow-sm border border-gray-100">
          <div className="p-4 border-b border-gray-100">
            <h2 className="font-semibold text-gray-900 flex items-center gap-2">
              <Activity className="w-5 h-5 text-blue-500" />
              æœ€è¿‘æ´»åŠ¨
            </h2>
          </div>
          <div className="divide-y divide-gray-100 max-h-96 overflow-y-auto">
            {recentActivity.length === 0 ? (
              <div className="p-8 text-center text-gray-500">
                <Activity className="w-12 h-12 mx-auto mb-3 text-gray-300" />
                <p>æš‚æ— æ´»åŠ¨è®°å½•</p>
              </div>
            ) : (
              recentActivity.map(activity => (
                <div key={activity.id} className="p-4">
                  <div className="flex items-center gap-3">
                    <div className={`w-8 h-8 rounded-full flex items-center justify-center ${
                      activity.action.includes('approve') ? 'bg-green-100' :
                      activity.action.includes('reject') ? 'bg-red-100' : 'bg-blue-100'
                    }`}>
                      {activity.action.includes('approve') ? (
                        <CheckCircle className="w-4 h-4 text-green-600" />
                      ) : activity.action.includes('reject') ? (
                        <XCircle className="w-4 h-4 text-red-600" />
                      ) : (
                        <Activity className="w-4 h-4 text-blue-600" />
                      )}
                    </div>
                    <div>
                      <p className="text-sm text-gray-900">
                        <span className="font-medium">{activity.admin_name}</span>
                        {' '}{getActionText(activity.action)}{' '}
                        <span className="text-gray-500">{activity.target_type}</span>
                      </p>
                      <p className="text-xs text-gray-400">
                        {formatDistanceToNow(new Date(activity.created_at), { addSuffix: true, locale: zhCN })}
                      </p>
                    </div>
                  </div>
                </div>
              ))
            )}
          </div>
        </div>
      </div>
    </div>
  );
}

// ç»Ÿè®¡å¡ç‰‡ç»„ä»¶
function StatCard({ 
  title, 
  value, 
  icon, 
  color, 
  trend,
  format 
}: { 
  title: string; 
  value: number; 
  icon: React.ReactNode; 
  color: 'blue' | 'green' | 'yellow' | 'purple';
  trend?: 'up' | 'down' | 'stable';
  format?: 'xp';
}) {
  const colorStyles = {
    blue: 'bg-blue-50 text-blue-600',
    green: 'bg-green-50 text-green-600',
    yellow: 'bg-yellow-50 text-yellow-600',
    purple: 'bg-purple-50 text-purple-600',
  };

  const formatValue = (v: number) => {
    if (format === 'xp') {
      return v >= 1000 ? `${(v / 1000).toFixed(1)}K` : v.toString();
    }
    return v.toLocaleString();
  };

  return (
    <div className="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
      <div className="flex items-center justify-between mb-4">
        <div className={`p-3 rounded-xl ${colorStyles[color]}`}>
          {icon}
        </div>
        {trend && (
          <span className={`text-xs font-medium ${
            trend === 'up' ? 'text-red-500' : trend === 'down' ? 'text-green-500' : 'text-gray-400'
          }`}>
            {trend === 'up' ? 'â†‘ éœ€å…³æ³¨' : trend === 'down' ? 'â†“ ä¸‹é™' : 'â€” ç¨³å®š'}
          </span>
        )}
      </div>
      <p className="text-2xl font-bold text-gray-900">{formatValue(value)}</p>
      <p className="text-sm text-gray-500 mt-1">{title}</p>
    </div>
  );
}

function getActionText(action: string): string {
  const actionMap: Record<string, string> = {
    'review_submission': 'å®¡æ ¸äº†',
    'approve_submission': 'æ‰¹å‡†äº†',
    'reject_submission': 'æ‹’ç»äº†',
    'update_user': 'æ›´æ–°äº†',
    'ban_user': 'å°ç¦äº†',
  };
  return actionMap[action] || action;
}
```

---

### 6.3 AI Review Edge Function

```typescript
// supabase/functions/ai-review/index.ts (æ–°å»º)
import { serve } from 'https://deno.land/std@0.168.0/http/server.ts';
import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

const corsHeaders = {
  'Access-Control-Allow-Origin': '*',
  'Access-Control-Allow-Headers': 'authorization, x-client-info, apikey, content-type',
};

interface ReviewRequest {
  submission_id: string;
  task_type: string;
  content: string;
  attachments?: string[];
}

interface ReviewResult {
  score: number;
  feedback: string;
  suggestions: string[];
  flags: string[];
  confidence: number;
}

serve(async (req) => {
  // CORS é¢„æ£€
  if (req.method === 'OPTIONS') {
    return new Response('ok', { headers: corsHeaders });
  }

  try {
    const supabase = createClient(
      Deno.env.get('SUPABASE_URL') ?? '',
      Deno.env.get('SUPABASE_SERVICE_ROLE_KEY') ?? ''
    );

    const { submission_id, task_type, content, attachments }: ReviewRequest = await req.json();

    // éªŒè¯è¯·æ±‚
    if (!submission_id || !task_type || !content) {
      return new Response(
        JSON.stringify({ error: 'Missing required fields' }),
        { status: 400, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
      );
    }

    // è°ƒç”¨ OpenAI API è¿›è¡Œè¯„å®¡
    const openaiResponse = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Authorization': `Bearer ${Deno.env.get('OPENAI_API_KEY')}`,
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        model: 'gpt-4-turbo-preview',
        messages: [
          {
            role: 'system',
            content: `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ AI å·¥å…·è¯„æµ‹å®¡æ ¸å‘˜ã€‚ä½ éœ€è¦è¯„ä¼°ç”¨æˆ·æäº¤çš„è¯„æµ‹å†…å®¹æ˜¯å¦ç¬¦åˆä»¥ä¸‹æ ‡å‡†ï¼š

1. çœŸå®æ€§ï¼šå†…å®¹æ˜¯å¦åŸºäºçœŸå®ä½¿ç”¨ç»éªŒ
2. å®Œæ•´æ€§ï¼šæ˜¯å¦åŒ…å«å¿…è¦çš„å·¥ä½œæˆæœè¯æ®
3. ä¸“ä¸šæ€§ï¼šè¯„æµ‹æ˜¯å¦å®¢è§‚ã€æœ‰æ·±åº¦
4. åŸåˆ›æ€§ï¼šå†…å®¹æ˜¯å¦ä¸ºåŸåˆ›ï¼ŒéæŠ„è¢­

è¯·ä»¥ JSON æ ¼å¼è¿”å›è¯„å®¡ç»“æœï¼š
{
  "score": 0-100,
  "feedback": "è¯¦ç»†åé¦ˆ",
  "suggestions": ["æ”¹è¿›å»ºè®®1", "æ”¹è¿›å»ºè®®2"],
  "flags": ["å¯ç–‘ç‚¹1", "å¯ç–‘ç‚¹2"],
  "confidence": 0-1
}`
          },
          {
            role: 'user',
            content: `ä»»åŠ¡ç±»å‹: ${task_type}\n\næäº¤å†…å®¹:\n${content}\n\né™„ä»¶æ•°é‡: ${attachments?.length || 0}`
          }
        ],
        temperature: 0.3,
        response_format: { type: 'json_object' },
      }),
    });

    if (!openaiResponse.ok) {
      throw new Error('OpenAI API call failed');
    }

    const aiResult = await openaiResponse.json();
    const review: ReviewResult = JSON.parse(aiResult.choices[0].message.content);

    // ä¿å­˜ AI è¯„å®¡ç»“æœ
    const { error: updateError } = await supabase
      .from('task_submissions')
      .update({
        ai_review_score: review.score,
        ai_review_feedback: review.feedback,
        ai_review_suggestions: review.suggestions,
        ai_review_flags: review.flags,
        ai_review_confidence: review.confidence,
        ai_reviewed_at: new Date().toISOString(),
      })
      .eq('id', submission_id);

    if (updateError) {
      throw updateError;
    }

    // è‡ªåŠ¨å¤„ç†é«˜ç½®ä¿¡åº¦ç»“æœ
    if (review.confidence >= 0.9) {
      if (review.score >= 80 && review.flags.length === 0) {
        // è‡ªåŠ¨æ‰¹å‡†
        await supabase
          .from('task_submissions')
          .update({
            status: 'auto_approved',
            reviewed_at: new Date().toISOString(),
            reviewer_id: null, // æ ‡è®°ä¸º AI å®¡æ ¸
          })
          .eq('id', submission_id);
      } else if (review.score < 30 || review.flags.length >= 3) {
        // æ ‡è®°ä¸ºéœ€è¦äººå·¥å®¡æ ¸
        await supabase
          .from('task_submissions')
          .update({
            status: 'flagged',
            review_priority: 'high',
          })
          .eq('id', submission_id);
      }
    }

    return new Response(
      JSON.stringify({ success: true, review }),
      { headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );

  } catch (error) {
    console.error('AI Review error:', error);
    return new Response(
      JSON.stringify({ error: error.message }),
      { status: 500, headers: { ...corsHeaders, 'Content-Type': 'application/json' } }
    );
  }
});
```

#### Step 6.3.1: éƒ¨ç½² Edge Function

```bash
# éƒ¨ç½² Edge Function
supabase functions deploy ai-review --no-verify-jwt

# è®¾ç½®ç¯å¢ƒå˜é‡
supabase secrets set OPENAI_API_KEY=your_openai_api_key
```

---

### 6.4 Phase 4 éªŒè¯å’Œæäº¤

```bash
# éªŒè¯æ•°æ®åº“è¿ç§»
1. æ£€æŸ¥ profiles è¡¨æ˜¯å¦æœ‰ role åˆ—
2. æ£€æŸ¥ admin_audit_logs è¡¨æ˜¯å¦åˆ›å»º
3. æ£€æŸ¥ admin_dashboard_stats è§†å›¾

# éªŒè¯ Admin Dashboard
1. ç™»å½•ç®¡ç†å‘˜è´¦æˆ·
2. è®¿é—® /admin
3. æ£€æŸ¥ç»Ÿè®¡æ•°æ®æ˜¯å¦æ­£ç¡®

# éªŒè¯ AI Review
curl -X POST https://your-project.supabase.co/functions/v1/ai-review \
  -H "Content-Type: application/json" \
  -d '{"submission_id": "test", "task_type": "review", "content": "test content"}'

# æäº¤
git add -A
git commit -m "feat: Phase 4 - Admin Dashboard and AI Review system"
git push origin feat/phase4-admin
```

---

## ä¸ƒã€Phase 5: æ¸¸æˆåŒ–ç³»ç»Ÿ

> **æ¥æº**: èåˆï¼ˆClaude ç­‰çº§ + Manus å¾½ç« ï¼‰  
> **æ—¶é—´**: 3å¤©  
> **ç›®æ ‡**: å»ºç«‹å®Œæ•´çš„æ¸¸æˆåŒ–å¢é•¿å¼•æ“

### 7.1 æ•°æ®åº“è¿ç§» - Success Score ç³»ç»Ÿ

```sql
-- migrations/20260108_success_score.sql

-- 1. Success Score è¡¨ï¼ˆä½¿ç”¨ GENERATED ALWAYS ASï¼‰
CREATE TABLE IF NOT EXISTS user_success_scores (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  
  -- æ ¸å¿ƒæŒ‡æ ‡ï¼ˆ0-100ï¼‰
  quality_score NUMERIC(5,2) DEFAULT 0,        -- å¹³å‡è¯„æµ‹è´¨é‡
  response_rate NUMERIC(5,2) DEFAULT 100,      -- å“åº”ç‡
  completion_rate NUMERIC(5,2) DEFAULT 100,    -- å®Œæˆç‡
  consistency_score NUMERIC(5,2) DEFAULT 0,    -- ä¸€è‡´æ€§
  expertise_score NUMERIC(5,2) DEFAULT 0,      -- ä¸“ä¸šåº¦
  
  -- ç»Ÿè®¡æ•°æ®
  total_submissions INTEGER DEFAULT 0,
  approved_submissions INTEGER DEFAULT 0,
  rejected_submissions INTEGER DEFAULT 0,
  total_xp_earned INTEGER DEFAULT 0,
  
  -- è‡ªåŠ¨è®¡ç®—çš„ç»¼åˆåˆ†æ•°
  overall_score NUMERIC(5,2) GENERATED ALWAYS AS (
    GREATEST(0, LEAST(100,
      (COALESCE(quality_score, 0) * 0.30) +
      (COALESCE(response_rate, 100) * 0.15) +
      (COALESCE(completion_rate, 100) * 0.20) +
      (COALESCE(consistency_score, 0) * 0.15) +
      (COALESCE(expertise_score, 0) * 0.20)
    ))
  ) STORED,
  
  -- ç­‰çº§ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
  tier VARCHAR(20) GENERATED ALWAYS AS (
    CASE
      WHEN (COALESCE(quality_score, 0) * 0.30 + COALESCE(response_rate, 100) * 0.15 + 
            COALESCE(completion_rate, 100) * 0.20 + COALESCE(consistency_score, 0) * 0.15 + 
            COALESCE(expertise_score, 0) * 0.20) >= 90 THEN 'elite'
      WHEN (COALESCE(quality_score, 0) * 0.30 + COALESCE(response_rate, 100) * 0.15 + 
            COALESCE(completion_rate, 100) * 0.20 + COALESCE(consistency_score, 0) * 0.15 + 
            COALESCE(expertise_score, 0) * 0.20) >= 75 THEN 'expert'
      WHEN (COALESCE(quality_score, 0) * 0.30 + COALESCE(response_rate, 100) * 0.15 + 
            COALESCE(completion_rate, 100) * 0.20 + COALESCE(consistency_score, 0) * 0.15 + 
            COALESCE(expertise_score, 0) * 0.20) >= 50 THEN 'intermediate'
      ELSE 'beginner'
    END
  ) STORED,
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  UNIQUE(user_id)
);

-- 2. ç­‰çº§ç³»ç»Ÿè¡¨
CREATE TABLE IF NOT EXISTS user_levels (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  level INTEGER DEFAULT 1,
  title VARCHAR(50) DEFAULT 'æ–°æ‰‹è¯„æµ‹å‘˜',
  current_xp INTEGER DEFAULT 0,
  xp_to_next_level INTEGER DEFAULT 100,
  
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  
  UNIQUE(user_id)
);

-- 3. ç­‰çº§é…ç½®è¡¨
CREATE TABLE IF NOT EXISTS level_configs (
  level INTEGER PRIMARY KEY,
  title VARCHAR(50) NOT NULL,
  min_xp INTEGER NOT NULL,
  max_xp INTEGER NOT NULL,
  perks JSONB DEFAULT '[]'::jsonb,
  badge_url VARCHAR(255)
);

-- æ’å…¥ç­‰çº§é…ç½®
INSERT INTO level_configs (level, title, min_xp, max_xp, perks) VALUES
(1, 'æ–°æ‰‹è¯„æµ‹å‘˜', 0, 99, '[]'),
(2, 'åˆçº§è¯„æµ‹å‘˜', 100, 299, '["early_access"]'),
(3, 'ä¸­çº§è¯„æµ‹å‘˜', 300, 599, '["early_access", "priority_tasks"]'),
(4, 'é«˜çº§è¯„æµ‹å‘˜', 600, 999, '["early_access", "priority_tasks", "bonus_xp_5"]'),
(5, 'èµ„æ·±è¯„æµ‹å‘˜', 1000, 1999, '["early_access", "priority_tasks", "bonus_xp_10"]'),
(6, 'ä¸“å®¶è¯„æµ‹å‘˜', 2000, 3999, '["early_access", "priority_tasks", "bonus_xp_15", "exclusive_tasks"]'),
(7, 'å¤§å¸ˆè¯„æµ‹å‘˜', 4000, 7999, '["early_access", "priority_tasks", "bonus_xp_20", "exclusive_tasks"]'),
(8, 'ä¼ å¥‡è¯„æµ‹å‘˜', 8000, 14999, '["all_perks", "bonus_xp_25"]'),
(9, 'ç¥è¯è¯„æµ‹å‘˜', 15000, 29999, '["all_perks", "bonus_xp_30"]'),
(10, 'è‡³å°Šè¯„æµ‹å‘˜', 30000, 999999999, '["all_perks", "bonus_xp_50", "custom_badge"]')
ON CONFLICT (level) DO UPDATE SET
  title = EXCLUDED.title,
  min_xp = EXCLUDED.min_xp,
  max_xp = EXCLUDED.max_xp,
  perks = EXCLUDED.perks;

-- 4. å¾½ç« ç³»ç»Ÿè¡¨
CREATE TABLE IF NOT EXISTS badges (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL,
  description TEXT,
  icon_url VARCHAR(255),
  category VARCHAR(50) NOT NULL, -- achievement, milestone, special
  rarity VARCHAR(20) DEFAULT 'common', -- common, rare, epic, legendary
  criteria JSONB NOT NULL, -- è·å–æ¡ä»¶
  xp_reward INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- 5. ç”¨æˆ·å¾½ç« å…³è”è¡¨
CREATE TABLE IF NOT EXISTS user_badges (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE,
  badge_id UUID NOT NULL REFERENCES badges(id) ON DELETE CASCADE,
  earned_at TIMESTAMPTZ DEFAULT NOW(),
  
  UNIQUE(user_id, badge_id)
);

-- æ’å…¥é»˜è®¤å¾½ç« 
INSERT INTO badges (name, description, category, rarity, criteria, xp_reward) VALUES
('é¦–æ¬¡æäº¤', 'å®Œæˆç¬¬ä¸€æ¬¡ä»»åŠ¡æäº¤', 'milestone', 'common', '{"type": "submission_count", "value": 1}', 10),
('è¯„æµ‹æ–°æ˜Ÿ', 'å®Œæˆ10æ¬¡ä»»åŠ¡æäº¤', 'milestone', 'common', '{"type": "submission_count", "value": 10}', 50),
('è¯„æµ‹è¾¾äºº', 'å®Œæˆ50æ¬¡ä»»åŠ¡æäº¤', 'milestone', 'rare', '{"type": "submission_count", "value": 50}', 200),
('è¯„æµ‹å¤§å¸ˆ', 'å®Œæˆ100æ¬¡ä»»åŠ¡æäº¤', 'milestone', 'epic', '{"type": "submission_count", "value": 100}', 500),
('å®Œç¾è¯„æµ‹', 'è·å¾—100åˆ†çš„è¯„æµ‹', 'achievement', 'rare', '{"type": "perfect_score", "value": 1}', 100),
('è¿ç»­7å¤©', 'è¿ç»­7å¤©æäº¤ä»»åŠ¡', 'achievement', 'rare', '{"type": "streak", "value": 7}', 150),
('è¿ç»­30å¤©', 'è¿ç»­30å¤©æäº¤ä»»åŠ¡', 'achievement', 'epic', '{"type": "streak", "value": 30}', 500),
('AIä¸“å®¶', 'å®Œæˆ10ä¸ªAIå·¥å…·è¯„æµ‹', 'achievement', 'rare', '{"type": "category_count", "category": "ai", "value": 10}', 200),
('æ—©æœŸç”¨æˆ·', 'å¹³å°å‰1000åæ³¨å†Œç”¨æˆ·', 'special', 'legendary', '{"type": "early_user", "value": 1000}', 300)
ON CONFLICT DO NOTHING;

-- 6. åˆ›å»ºç´¢å¼•
CREATE INDEX idx_success_scores_user_id ON user_success_scores(user_id);
CREATE INDEX idx_success_scores_tier ON user_success_scores(tier);
CREATE INDEX idx_success_scores_overall ON user_success_scores(overall_score DESC);
CREATE INDEX idx_user_levels_user_id ON user_levels(user_id);
CREATE INDEX idx_user_levels_level ON user_levels(level DESC);
CREATE INDEX idx_user_badges_user_id ON user_badges(user_id);
CREATE INDEX idx_badges_category ON badges(category);

-- 7. RLS ç­–ç•¥
ALTER TABLE user_success_scores ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_levels ENABLE ROW LEVEL SECURITY;
ALTER TABLE user_badges ENABLE ROW LEVEL SECURITY;
ALTER TABLE badges ENABLE ROW LEVEL SECURITY;

-- ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ Success Score
CREATE POLICY "Users can view own success score"
  ON user_success_scores FOR SELECT
  TO authenticated
  USING (user_id = auth.uid());

-- ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„ç­‰çº§
CREATE POLICY "Users can view own level"
  ON user_levels FOR SELECT
  TO authenticated
  USING (user_id = auth.uid());

-- ç”¨æˆ·å¯ä»¥æŸ¥çœ‹è‡ªå·±çš„å¾½ç« 
CREATE POLICY "Users can view own badges"
  ON user_badges FOR SELECT
  TO authenticated
  USING (user_id = auth.uid());

-- æ‰€æœ‰äººå¯ä»¥æŸ¥çœ‹å¾½ç« å®šä¹‰
CREATE POLICY "Anyone can view badges"
  ON badges FOR SELECT
  TO authenticated
  USING (true);

-- 8. è‡ªåŠ¨æ›´æ–° Success Score çš„è§¦å‘å™¨
CREATE OR REPLACE FUNCTION update_success_score()
RETURNS TRIGGER AS $$
DECLARE
  v_user_id UUID;
  v_quality NUMERIC;
  v_completion NUMERIC;
  v_total INTEGER;
  v_approved INTEGER;
  v_rejected INTEGER;
BEGIN
  v_user_id := COALESCE(NEW.user_id, OLD.user_id);
  
  -- è®¡ç®—ç»Ÿè®¡æ•°æ®
  SELECT 
    COUNT(*),
    COUNT(*) FILTER (WHERE status = 'approved'),
    COUNT(*) FILTER (WHERE status = 'rejected'),
    COALESCE(AVG(quality_score) FILTER (WHERE status = 'approved'), 0)
  INTO v_total, v_approved, v_rejected, v_quality
  FROM task_submissions
  WHERE user_id = v_user_id;
  
  -- è®¡ç®—å®Œæˆç‡
  v_completion := CASE WHEN v_total > 0 
    THEN (v_approved::NUMERIC / v_total * 100) 
    ELSE 100 END;
  
  -- æ›´æ–°æˆ–æ’å…¥ Success Score
  INSERT INTO user_success_scores (
    user_id,
    quality_score,
    completion_rate,
    total_submissions,
    approved_submissions,
    rejected_submissions,
    updated_at
  ) VALUES (
    v_user_id,
    v_quality,
    v_completion,
    v_total,
    v_approved,
    v_rejected,
    NOW()
  )
  ON CONFLICT (user_id) DO UPDATE SET
    quality_score = EXCLUDED.quality_score,
    completion_rate = EXCLUDED.completion_rate,
    total_submissions = EXCLUDED.total_submissions,
    approved_submissions = EXCLUDED.approved_submissions,
    rejected_submissions = EXCLUDED.rejected_submissions,
    updated_at = NOW();
  
  RETURN COALESCE(NEW, OLD);
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- åˆ›å»ºè§¦å‘å™¨
DROP TRIGGER IF EXISTS trigger_update_success_score ON task_submissions;
CREATE TRIGGER trigger_update_success_score
  AFTER INSERT OR UPDATE OR DELETE ON task_submissions
  FOR EACH ROW
  EXECUTE FUNCTION update_success_score();

-- 9. è‡ªåŠ¨å‡çº§ç­‰çº§çš„è§¦å‘å™¨
CREATE OR REPLACE FUNCTION check_level_up()
RETURNS TRIGGER AS $$
DECLARE
  v_new_level INTEGER;
  v_new_title VARCHAR(50);
  v_current_xp INTEGER;
BEGIN
  -- è·å–å½“å‰ XP
  SELECT COALESCE(SUM(xp), 0) INTO v_current_xp
  FROM xp_events
  WHERE user_id = NEW.user_id;
  
  -- æŸ¥æ‰¾æ–°ç­‰çº§
  SELECT level, title INTO v_new_level, v_new_title
  FROM level_configs
  WHERE min_xp <= v_current_xp AND max_xp >= v_current_xp
  LIMIT 1;
  
  -- æ›´æ–°ç”¨æˆ·ç­‰çº§
  INSERT INTO user_levels (user_id, level, title, current_xp)
  VALUES (NEW.user_id, v_new_level, v_new_title, v_current_xp)
  ON CONFLICT (user_id) DO UPDATE SET
    level = v_new_level,
    title = v_new_title,
    current_xp = v_current_xp,
    xp_to_next_level = (
      SELECT min_xp FROM level_configs WHERE level = v_new_level + 1
    ) - v_current_xp,
    updated_at = NOW();
  
  -- åŒæ—¶æ›´æ–° profiles è¡¨
  UPDATE profiles SET
    level = v_new_level,
    xp = v_current_xp
  WHERE id = NEW.user_id;
  
  RETURN NEW;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- åˆ›å»ºè§¦å‘å™¨
DROP TRIGGER IF EXISTS trigger_check_level_up ON xp_events;
CREATE TRIGGER trigger_check_level_up
  AFTER INSERT ON xp_events
  FOR EACH ROW
  EXECUTE FUNCTION check_level_up();
```

---

### 7.2 Success Score å±•ç¤ºç»„ä»¶

```tsx
// src/components/SuccessScoreCard.tsx (æ–°å»º)
import { useState, useEffect } from 'react';
import { motion } from 'framer-motion';
import { 
  TrendingUp, 
  Star, 
  Target, 
  Zap, 
  Award,
  ChevronRight,
  Info
} from 'lucide-react';
import { supabase } from '@/lib/supabase';
import { useAuth } from '@/contexts/AuthContext';

interface SuccessScore {
  overall_score: number;
  tier: 'beginner' | 'intermediate' | 'expert' | 'elite';
  quality_score: number;
  response_rate: number;
  completion_rate: number;
  consistency_score: number;
  expertise_score: number;
  total_submissions: number;
  approved_submissions: number;
}

const tierConfig = {
  beginner: { label: 'åˆå­¦è€…', color: 'gray', icon: 'ğŸŒ±' },
  intermediate: { label: 'è¿›é˜¶è€…', color: 'blue', icon: 'ğŸŒŸ' },
  expert: { label: 'ä¸“å®¶', color: 'purple', icon: 'ğŸ’' },
  elite: { label: 'ç²¾è‹±', color: 'gold', icon: 'ğŸ‘‘' },
};

export function SuccessScoreCard() {
  const { user } = useAuth();
  const [score, setScore] = useState<SuccessScore | null>(null);
  const [loading, setLoading] = useState(true);
  const [showDetails, setShowDetails] = useState(false);

  useEffect(() => {
    if (!user) return;

    const fetchScore = async () => {
      const { data, error } = await supabase
        .from('user_success_scores')
        .select('*')
        .eq('user_id', user.id)
        .single();

      if (!error && data) {
        setScore(data);
      }
      setLoading(false);
    };

    fetchScore();
  }, [user]);

  if (loading) {
    return (
      <div className="bg-white rounded-xl p-6 shadow-sm animate-pulse">
        <div className="h-6 w-32 bg-gray-200 rounded mb-4" />
        <div className="h-24 bg-gray-200 rounded" />
      </div>
    );
  }

  if (!score) {
    return (
      <div className="bg-white rounded-xl p-6 shadow-sm">
        <h3 className="font-semibold text-gray-900 mb-2">Success Score</h3>
        <p className="text-gray-500 text-sm">å®Œæˆç¬¬ä¸€ä¸ªä»»åŠ¡åè§£é”</p>
      </div>
    );
  }

  const tier = tierConfig[score.tier];

  return (
    <motion.div
      className="bg-white rounded-xl shadow-sm overflow-hidden"
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
    >
      {/* å¤´éƒ¨ */}
      <div className="p-6 bg-gradient-to-r from-blue-600 to-purple-600 text-white">
        <div className="flex items-center justify-between mb-4">
          <h3 className="font-semibold flex items-center gap-2">
            <TrendingUp className="w-5 h-5" />
            Success Score
          </h3>
          <span className="text-2xl">{tier.icon}</span>
        </div>
        
        <div className="flex items-end gap-4">
          <div className="text-5xl font-bold">
            {Math.round(score.overall_score)}
          </div>
          <div className="pb-1">
            <span className="text-white/80 text-sm">/ 100</span>
            <div className="text-sm font-medium mt-1 px-2 py-0.5 bg-white/20 rounded-full">
              {tier.label}
            </div>
          </div>
        </div>
        
        {/* è¿›åº¦æ¡ */}
        <div className="mt-4">
          <div className="h-2 bg-white/20 rounded-full overflow-hidden">
            <motion.div
              className="h-full bg-white rounded-full"
              initial={{ width: 0 }}
              animate={{ width: `${score.overall_score}%` }}
              transition={{ duration: 1, ease: 'easeOut' }}
            />
          </div>
        </div>
      </div>

      {/* è¯¦æƒ… */}
      <div className="p-6">
        <button
          onClick={() => setShowDetails(!showDetails)}
          className="w-full flex items-center justify-between text-sm text-gray-600 hover:text-gray-900"
        >
          <span>æŸ¥çœ‹è¯¦ç»†æŒ‡æ ‡</span>
          <ChevronRight className={`w-4 h-4 transition-transform ${showDetails ? 'rotate-90' : ''}`} />
        </button>

        {showDetails && (
          <motion.div
            className="mt-4 space-y-4"
            initial={{ opacity: 0, height: 0 }}
            animate={{ opacity: 1, height: 'auto' }}
          >
            <ScoreMetric
              icon={<Star className="w-4 h-4" />}
              label="è´¨é‡è¯„åˆ†"
              value={score.quality_score}
              weight={30}
            />
            <ScoreMetric
              icon={<Zap className="w-4 h-4" />}
              label="å“åº”ç‡"
              value={score.response_rate}
              weight={15}
            />
            <ScoreMetric
              icon={<Target className="w-4 h-4" />}
              label="å®Œæˆç‡"
              value={score.completion_rate}
              weight={20}
            />
            <ScoreMetric
              icon={<Award className="w-4 h-4" />}
              label="ä¸€è‡´æ€§"
              value={score.consistency_score}
              weight={15}
            />
            <ScoreMetric
              icon={<TrendingUp className="w-4 h-4" />}
              label="ä¸“ä¸šåº¦"
              value={score.expertise_score}
              weight={20}
            />

            <div className="pt-4 border-t border-gray-100">
              <div className="flex items-center gap-2 text-xs text-gray-500">
                <Info className="w-3 h-3" />
                <span>åŸºäº {score.total_submissions} æ¬¡æäº¤è®¡ç®—</span>
              </div>
            </div>
          </motion.div>
        )}
      </div>
    </motion.div>
  );
}

function ScoreMetric({ 
  icon, 
  label, 
  value, 
  weight 
}: { 
  icon: React.ReactNode; 
  label: string; 
  value: number; 
  weight: number;
}) {
  const getColor = (v: number) => {
    if (v >= 80) return 'text-green-600 bg-green-50';
    if (v >= 60) return 'text-blue-600 bg-blue-50';
    if (v >= 40) return 'text-yellow-600 bg-yellow-50';
    return 'text-red-600 bg-red-50';
  };

  return (
    <div className="flex items-center justify-between">
      <div className="flex items-center gap-2 text-gray-600">
        {icon}
        <span className="text-sm">{label}</span>
        <span className="text-xs text-gray-400">({weight}%)</span>
      </div>
      <div className={`px-2 py-1 rounded-full text-sm font-medium ${getColor(value)}`}>
        {Math.round(value)}
      </div>
    </div>
  );
}
```

---

### 7.3 Phase 5 éªŒè¯å’Œæäº¤

```bash
# éªŒè¯æ•°æ®åº“
1. æ£€æŸ¥ user_success_scores è¡¨
2. æ£€æŸ¥ user_levels è¡¨
3. æ£€æŸ¥ badges è¡¨
4. æ£€æŸ¥è§¦å‘å™¨æ˜¯å¦æ­£å¸¸å·¥ä½œ

# éªŒè¯ç»„ä»¶
1. ç™»å½•ç”¨æˆ·è´¦æˆ·
2. è®¿é—® Dashboard
3. æ£€æŸ¥ Success Score å¡ç‰‡æ˜¯å¦æ˜¾ç¤º

# æäº¤
git add -A
git commit -m "feat: Phase 5 - Gamification system (Success Score, Levels, Badges)"
git push origin feat/phase5-gamification
```



---

## å…«ã€Phase 6: SEO + å¯è®¿é—®æ€§

> **æ¥æº**: Manus æ–¹æ¡ˆï¼ˆClaude ç¼ºå¤±ï¼‰  
> **æ—¶é—´**: 3å¤©  
> **ç›®æ ‡**: ç¬¦åˆ 2025 å¹´ Web æ ‡å‡†

### 8.1 SEO ç»“æ„åŒ–æ•°æ®

```tsx
// src/components/SEO.tsx (æ–°å»º)
import { Helmet } from 'react-helmet-async';

interface SEOProps {
  title?: string;
  description?: string;
  keywords?: string[];
  image?: string;
  url?: string;
  type?: 'website' | 'article' | 'profile';
  schema?: object;
  noindex?: boolean;
}

const defaultMeta = {
  title: 'Follow.ai - AI å·¥å…·çœŸå®è¯„æµ‹å¹³å°',
  description: 'å…¨çƒé¦–ä¸ªè¦æ±‚æäº¤çœŸå®å·¥ä½œæˆæœçš„ AI å·¥å…·è¯„æµ‹å¹³å°ã€‚å®Œæˆè¯„æµ‹ä»»åŠ¡ï¼Œè·å¾— $20-200 æŠ¥é…¬ã€‚',
  image: 'https://follow.ai/og-image.png',
  url: 'https://follow.ai',
};

export function SEO({
  title,
  description = defaultMeta.description,
  keywords = ['AIå·¥å…·', 'è¯„æµ‹', 'ä¼—åŒ…', 'èµšé’±'],
  image = defaultMeta.image,
  url = defaultMeta.url,
  type = 'website',
  schema,
  noindex = false,
}: SEOProps) {
  const fullTitle = title ? `${title} | Follow.ai` : defaultMeta.title;

  // é»˜è®¤ Organization Schema
  const organizationSchema = {
    '@context': 'https://schema.org',
    '@type': 'Organization',
    name: 'Follow.ai',
    url: 'https://follow.ai',
    logo: 'https://follow.ai/logo.png',
    sameAs: [
      'https://twitter.com/followai',
      'https://github.com/follow-ai',
    ],
    contactPoint: {
      '@type': 'ContactPoint',
      email: 'support@follow.ai',
      contactType: 'customer service',
    },
  };

  // é»˜è®¤ WebSite Schema
  const websiteSchema = {
    '@context': 'https://schema.org',
    '@type': 'WebSite',
    name: 'Follow.ai',
    url: 'https://follow.ai',
    potentialAction: {
      '@type': 'SearchAction',
      target: 'https://follow.ai/tasks?q={search_term_string}',
      'query-input': 'required name=search_term_string',
    },
  };

  return (
    <Helmet>
      {/* åŸºç¡€ Meta */}
      <title>{fullTitle}</title>
      <meta name="description" content={description} />
      <meta name="keywords" content={keywords.join(', ')} />
      <link rel="canonical" href={url} />
      
      {noindex && <meta name="robots" content="noindex, nofollow" />}

      {/* Open Graph */}
      <meta property="og:type" content={type} />
      <meta property="og:title" content={fullTitle} />
      <meta property="og:description" content={description} />
      <meta property="og:image" content={image} />
      <meta property="og:url" content={url} />
      <meta property="og:site_name" content="Follow.ai" />
      <meta property="og:locale" content="zh_CN" />

      {/* Twitter Card */}
      <meta name="twitter:card" content="summary_large_image" />
      <meta name="twitter:title" content={fullTitle} />
      <meta name="twitter:description" content={description} />
      <meta name="twitter:image" content={image} />
      <meta name="twitter:site" content="@followai" />

      {/* ç»“æ„åŒ–æ•°æ® */}
      <script type="application/ld+json">
        {JSON.stringify(organizationSchema)}
      </script>
      <script type="application/ld+json">
        {JSON.stringify(websiteSchema)}
      </script>
      {schema && (
        <script type="application/ld+json">
          {JSON.stringify(schema)}
        </script>
      )}
    </Helmet>
  );
}

// ä»»åŠ¡é¡µé¢ä¸“ç”¨ Schema
export function TaskSEO({ 
  task 
}: { 
  task: { 
    id: string; 
    title: string; 
    description: string; 
    reward: number;
    deadline?: string;
  } 
}) {
  const taskSchema = {
    '@context': 'https://schema.org',
    '@type': 'JobPosting',
    title: task.title,
    description: task.description,
    datePosted: new Date().toISOString(),
    validThrough: task.deadline,
    employmentType: 'CONTRACTOR',
    hiringOrganization: {
      '@type': 'Organization',
      name: 'Follow.ai',
      sameAs: 'https://follow.ai',
    },
    baseSalary: {
      '@type': 'MonetaryAmount',
      currency: 'USD',
      value: {
        '@type': 'QuantitativeValue',
        value: task.reward,
        unitText: 'TASK',
      },
    },
    jobLocation: {
      '@type': 'Place',
      address: {
        '@type': 'PostalAddress',
        addressCountry: 'Remote',
      },
    },
  };

  return (
    <SEO
      title={task.title}
      description={task.description}
      url={`https://follow.ai/tasks/${task.id}`}
      type="article"
      schema={taskSchema}
    />
  );
}

// ç”¨æˆ·èµ„æ–™é¡µé¢ä¸“ç”¨ Schema
export function ProfileSEO({ 
  user 
}: { 
  user: { 
    username: string; 
    bio?: string; 
    avatar_url?: string;
    level: number;
  } 
}) {
  const profileSchema = {
    '@context': 'https://schema.org',
    '@type': 'Person',
    name: user.username,
    description: user.bio,
    image: user.avatar_url,
    url: `https://follow.ai/users/${user.username}`,
  };

  return (
    <SEO
      title={`${user.username} çš„ä¸ªäººä¸»é¡µ`}
      description={user.bio || `${user.username} æ˜¯ Follow.ai çš„ Lv.${user.level} è¯„æµ‹å‘˜`}
      image={user.avatar_url}
      url={`https://follow.ai/users/${user.username}`}
      type="profile"
      schema={profileSchema}
    />
  );
}
```

---

### 8.2 XML Sitemap ç”Ÿæˆ

```typescript
// scripts/generate-sitemap.ts (æ–°å»º)
import { createClient } from '@supabase/supabase-js';
import { writeFileSync } from 'fs';

const supabase = createClient(
  process.env.VITE_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_ROLE_KEY!
);

interface SitemapURL {
  loc: string;
  lastmod?: string;
  changefreq?: 'always' | 'hourly' | 'daily' | 'weekly' | 'monthly' | 'yearly' | 'never';
  priority?: number;
}

async function generateSitemap() {
  const baseUrl = 'https://follow.ai';
  const urls: SitemapURL[] = [];

  // é™æ€é¡µé¢
  const staticPages = [
    { path: '/', priority: 1.0, changefreq: 'daily' as const },
    { path: '/tasks', priority: 0.9, changefreq: 'hourly' as const },
    { path: '/leaderboard', priority: 0.7, changefreq: 'daily' as const },
    { path: '/about', priority: 0.5, changefreq: 'monthly' as const },
    { path: '/faq', priority: 0.5, changefreq: 'monthly' as const },
    { path: '/terms', priority: 0.3, changefreq: 'yearly' as const },
    { path: '/privacy', priority: 0.3, changefreq: 'yearly' as const },
  ];

  staticPages.forEach(page => {
    urls.push({
      loc: `${baseUrl}${page.path}`,
      lastmod: new Date().toISOString().split('T')[0],
      changefreq: page.changefreq,
      priority: page.priority,
    });
  });

  // åŠ¨æ€ä»»åŠ¡é¡µé¢
  const { data: tasks } = await supabase
    .from('tasks')
    .select('id, updated_at')
    .eq('is_active', true)
    .order('updated_at', { ascending: false });

  tasks?.forEach(task => {
    urls.push({
      loc: `${baseUrl}/tasks/${task.id}`,
      lastmod: new Date(task.updated_at).toISOString().split('T')[0],
      changefreq: 'weekly',
      priority: 0.8,
    });
  });

  // ç”Ÿæˆ XML
  const xml = `<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
${urls.map(url => `  <url>
    <loc>${url.loc}</loc>
    ${url.lastmod ? `<lastmod>${url.lastmod}</lastmod>` : ''}
    ${url.changefreq ? `<changefreq>${url.changefreq}</changefreq>` : ''}
    ${url.priority !== undefined ? `<priority>${url.priority}</priority>` : ''}
  </url>`).join('\n')}
</urlset>`;

  writeFileSync('public/sitemap.xml', xml);
  console.log(`Generated sitemap with ${urls.length} URLs`);
}

generateSitemap().catch(console.error);
```

#### Step 8.2.1: æ·»åŠ  Sitemap ç”Ÿæˆè„šæœ¬

```json
// package.json (æ·»åŠ è„šæœ¬)
{
  "scripts": {
    "generate:sitemap": "tsx scripts/generate-sitemap.ts"
  }
}
```

---

### 8.3 å¯è®¿é—®æ€§å·¥å…·åº“

```typescript
// src/lib/a11y.ts (æ–°å»º)
import { useEffect, useRef, useCallback } from 'react';

/**
 * é”®ç›˜å¯¼èˆª Hook
 * æ”¯æŒæ–¹å‘é”®ã€Tabã€Enterã€Escape å¯¼èˆª
 */
export function useKeyboardNavigation<T extends HTMLElement>(
  items: T[],
  options: {
    orientation?: 'horizontal' | 'vertical' | 'both';
    loop?: boolean;
    onSelect?: (index: number) => void;
    onEscape?: () => void;
  } = {}
) {
  const { 
    orientation = 'vertical', 
    loop = true, 
    onSelect, 
    onEscape 
  } = options;
  
  const currentIndex = useRef(0);

  const handleKeyDown = useCallback((event: KeyboardEvent) => {
    const { key } = event;
    let newIndex = currentIndex.current;
    const maxIndex = items.length - 1;

    switch (key) {
      case 'ArrowDown':
        if (orientation === 'vertical' || orientation === 'both') {
          event.preventDefault();
          newIndex = loop 
            ? (currentIndex.current + 1) % items.length
            : Math.min(currentIndex.current + 1, maxIndex);
        }
        break;
      case 'ArrowUp':
        if (orientation === 'vertical' || orientation === 'both') {
          event.preventDefault();
          newIndex = loop
            ? (currentIndex.current - 1 + items.length) % items.length
            : Math.max(currentIndex.current - 1, 0);
        }
        break;
      case 'ArrowRight':
        if (orientation === 'horizontal' || orientation === 'both') {
          event.preventDefault();
          newIndex = loop
            ? (currentIndex.current + 1) % items.length
            : Math.min(currentIndex.current + 1, maxIndex);
        }
        break;
      case 'ArrowLeft':
        if (orientation === 'horizontal' || orientation === 'both') {
          event.preventDefault();
          newIndex = loop
            ? (currentIndex.current - 1 + items.length) % items.length
            : Math.max(currentIndex.current - 1, 0);
        }
        break;
      case 'Home':
        event.preventDefault();
        newIndex = 0;
        break;
      case 'End':
        event.preventDefault();
        newIndex = maxIndex;
        break;
      case 'Enter':
      case ' ':
        event.preventDefault();
        onSelect?.(currentIndex.current);
        return;
      case 'Escape':
        event.preventDefault();
        onEscape?.();
        return;
      default:
        return;
    }

    if (newIndex !== currentIndex.current) {
      currentIndex.current = newIndex;
      items[newIndex]?.focus();
    }
  }, [items, orientation, loop, onSelect, onEscape]);

  return { handleKeyDown, currentIndex };
}

/**
 * Focus Trap Hook
 * å°†ç„¦ç‚¹é™åˆ¶åœ¨å®¹å™¨å†…ï¼ˆç”¨äºæ¨¡æ€æ¡†ï¼‰
 */
export function useFocusTrap(isActive: boolean = true) {
  const containerRef = useRef<HTMLDivElement>(null);
  const previousActiveElement = useRef<HTMLElement | null>(null);

  useEffect(() => {
    if (!isActive || !containerRef.current) return;

    // ä¿å­˜å½“å‰ç„¦ç‚¹å…ƒç´ 
    previousActiveElement.current = document.activeElement as HTMLElement;

    // è·å–æ‰€æœ‰å¯èšç„¦å…ƒç´ 
    const getFocusableElements = () => {
      if (!containerRef.current) return [];
      return Array.from(
        containerRef.current.querySelectorAll<HTMLElement>(
          'button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'
        )
      ).filter(el => !el.hasAttribute('disabled') && el.offsetParent !== null);
    };

    // èšç„¦ç¬¬ä¸€ä¸ªå…ƒç´ 
    const focusableElements = getFocusableElements();
    if (focusableElements.length > 0) {
      focusableElements[0].focus();
    }

    // å¤„ç† Tab é”®
    const handleKeyDown = (event: KeyboardEvent) => {
      if (event.key !== 'Tab') return;

      const focusable = getFocusableElements();
      if (focusable.length === 0) return;

      const firstElement = focusable[0];
      const lastElement = focusable[focusable.length - 1];

      if (event.shiftKey) {
        if (document.activeElement === firstElement) {
          event.preventDefault();
          lastElement.focus();
        }
      } else {
        if (document.activeElement === lastElement) {
          event.preventDefault();
          firstElement.focus();
        }
      }
    };

    document.addEventListener('keydown', handleKeyDown);

    return () => {
      document.removeEventListener('keydown', handleKeyDown);
      // æ¢å¤ä¹‹å‰çš„ç„¦ç‚¹
      previousActiveElement.current?.focus();
    };
  }, [isActive]);

  return containerRef;
}

/**
 * å±å¹•é˜…è¯»å™¨å…¬å‘Š Hook
 */
export function useAnnounce() {
  const announce = useCallback((message: string, priority: 'polite' | 'assertive' = 'polite') => {
    const announcement = document.createElement('div');
    announcement.setAttribute('role', 'status');
    announcement.setAttribute('aria-live', priority);
    announcement.setAttribute('aria-atomic', 'true');
    announcement.className = 'sr-only';
    announcement.textContent = message;
    
    document.body.appendChild(announcement);
    
    // å»¶è¿Ÿç§»é™¤ï¼Œç¡®ä¿å±å¹•é˜…è¯»å™¨èƒ½è¯»å–
    setTimeout(() => {
      document.body.removeChild(announcement);
    }, 1000);
  }, []);

  return announce;
}

/**
 * è·³è¿‡é“¾æ¥ç»„ä»¶
 */
export function SkipLinks() {
  return (
    <div className="sr-only focus-within:not-sr-only">
      <a
        href="#main-content"
        className="absolute top-0 left-0 z-50 p-4 bg-blue-600 text-white focus:outline-none"
      >
        è·³è½¬åˆ°ä¸»è¦å†…å®¹
      </a>
      <a
        href="#main-navigation"
        className="absolute top-0 left-32 z-50 p-4 bg-blue-600 text-white focus:outline-none"
      >
        è·³è½¬åˆ°å¯¼èˆª
      </a>
    </div>
  );
}

/**
 * å¯è®¿é—®æ€§æŒ‰é’®ç»„ä»¶
 */
interface AccessibleButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  loading?: boolean;
  loadingText?: string;
}

export function AccessibleButton({
  children,
  loading,
  loadingText = 'åŠ è½½ä¸­...',
  disabled,
  ...props
}: AccessibleButtonProps) {
  return (
    <button
      {...props}
      disabled={disabled || loading}
      aria-busy={loading}
      aria-disabled={disabled || loading}
    >
      {loading ? (
        <>
          <span className="sr-only">{loadingText}</span>
          <span aria-hidden="true">{loadingText}</span>
        </>
      ) : (
        children
      )}
    </button>
  );
}

/**
 * é¢œè‰²å¯¹æ¯”åº¦æ£€æŸ¥
 */
export function checkContrast(foreground: string, background: string): {
  ratio: number;
  passes: { AA: boolean; AAA: boolean; AALarge: boolean; AAALarge: boolean };
} {
  const getLuminance = (hex: string) => {
    const rgb = parseInt(hex.slice(1), 16);
    const r = (rgb >> 16) & 0xff;
    const g = (rgb >> 8) & 0xff;
    const b = (rgb >> 0) & 0xff;
    
    const [rs, gs, bs] = [r, g, b].map(c => {
      c = c / 255;
      return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
    });
    
    return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
  };

  const l1 = getLuminance(foreground);
  const l2 = getLuminance(background);
  const ratio = (Math.max(l1, l2) + 0.05) / (Math.min(l1, l2) + 0.05);

  return {
    ratio,
    passes: {
      AA: ratio >= 4.5,
      AAA: ratio >= 7,
      AALarge: ratio >= 3,
      AAALarge: ratio >= 4.5,
    },
  };
}
```

---

### 8.4 åœ¨ Layout ä¸­æ·»åŠ å¯è®¿é—®æ€§æ”¯æŒ

```tsx
// src/components/Layout.tsx (ä¿®æ”¹)
import { Outlet } from 'react-router-dom';
import { HelmetProvider } from 'react-helmet-async';
import { Navbar } from './Navbar';
import { Footer } from './Footer';
import { SkipLinks } from '@/lib/a11y';

export function Layout() {
  return (
    <HelmetProvider>
      <div className="min-h-screen flex flex-col">
        {/* è·³è¿‡é“¾æ¥ */}
        <SkipLinks />
        
        {/* å¯¼èˆª */}
        <header>
          <nav id="main-navigation" aria-label="ä¸»å¯¼èˆª">
            <Navbar />
          </nav>
        </header>
        
        {/* ä¸»è¦å†…å®¹ */}
        <main id="main-content" className="flex-1" role="main">
          <Outlet />
        </main>
        
        {/* é¡µè„š */}
        <Footer />
      </div>
    </HelmetProvider>
  );
}
```

---

### 8.5 Phase 6 éªŒè¯å’Œæäº¤

```bash
# SEO éªŒè¯
1. æ£€æŸ¥é¡µé¢ <head> ä¸­çš„ meta æ ‡ç­¾
2. æ£€æŸ¥ç»“æ„åŒ–æ•°æ®ï¼šhttps://search.google.com/test/rich-results
3. ç”Ÿæˆ sitemap: pnpm generate:sitemap
4. éªŒè¯ sitemap: https://www.xml-sitemaps.com/validate-xml-sitemap.html

# å¯è®¿é—®æ€§éªŒè¯
1. ä½¿ç”¨ axe DevTools æ‰«æ
2. ä½¿ç”¨é”®ç›˜å¯¼èˆªæµ‹è¯•
3. ä½¿ç”¨å±å¹•é˜…è¯»å™¨æµ‹è¯•
4. æ£€æŸ¥é¢œè‰²å¯¹æ¯”åº¦

# Lighthouse å®¡è®¡
npx lighthouse https://follow.ai --output html --output-path ./lighthouse-a11y.html

# æäº¤
git add -A
git commit -m "feat: Phase 6 - SEO and Accessibility (Schema.org, WCAG 2.2)"
git push origin feat/phase6-seo-a11y
```

---

## ä¹ã€Phase 7: æµ‹è¯•å®Œå–„

> **æ¥æº**: èåˆ  
> **æ—¶é—´**: 2å¤©  
> **ç›®æ ‡**: è¾¾åˆ° 80%+ æµ‹è¯•è¦†ç›–ç‡

### 9.1 Vitest é…ç½®

```typescript
// vitest.config.ts (æ–°å»º)
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react-swc';
import path from 'path';

export default defineConfig({
  plugins: [react()],
  test: {
    globals: true,
    environment: 'jsdom',
    setupFiles: ['./tests/setup.ts'],
    include: ['src/**/*.{test,spec}.{ts,tsx}'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      exclude: [
        'node_modules/',
        'tests/',
        '**/*.d.ts',
        '**/*.config.*',
        '**/types/*',
      ],
      thresholds: {
        statements: 70,
        branches: 70,
        functions: 70,
        lines: 70,
      },
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
```

### 9.2 æµ‹è¯•è®¾ç½®æ–‡ä»¶

```typescript
// tests/setup.ts (æ–°å»º)
import '@testing-library/jest-dom';
import { cleanup } from '@testing-library/react';
import { afterEach, vi } from 'vitest';

// æ¯ä¸ªæµ‹è¯•åæ¸…ç†
afterEach(() => {
  cleanup();
});

// Mock matchMedia
Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: vi.fn().mockImplementation(query => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: vi.fn(),
    removeListener: vi.fn(),
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn(),
  })),
});

// Mock IntersectionObserver
class MockIntersectionObserver {
  observe = vi.fn();
  disconnect = vi.fn();
  unobserve = vi.fn();
}
Object.defineProperty(window, 'IntersectionObserver', {
  writable: true,
  value: MockIntersectionObserver,
});

// Mock ResizeObserver
class MockResizeObserver {
  observe = vi.fn();
  disconnect = vi.fn();
  unobserve = vi.fn();
}
Object.defineProperty(window, 'ResizeObserver', {
  writable: true,
  value: MockResizeObserver,
});

// Mock Supabase
vi.mock('@/lib/supabase', () => ({
  supabase: {
    auth: {
      getSession: vi.fn().mockResolvedValue({ data: { session: null }, error: null }),
      signInWithPassword: vi.fn(),
      signUp: vi.fn(),
      signOut: vi.fn(),
      onAuthStateChange: vi.fn(() => ({ data: { subscription: { unsubscribe: vi.fn() } } })),
    },
    from: vi.fn(() => ({
      select: vi.fn().mockReturnThis(),
      insert: vi.fn().mockReturnThis(),
      update: vi.fn().mockReturnThis(),
      delete: vi.fn().mockReturnThis(),
      eq: vi.fn().mockReturnThis(),
      single: vi.fn().mockResolvedValue({ data: null, error: null }),
    })),
    removeAllChannels: vi.fn(),
  },
}));
```

### 9.3 å•å…ƒæµ‹è¯•ç¤ºä¾‹

```typescript
// src/lib/validations.test.ts (æ–°å»º)
import { describe, it, expect } from 'vitest';
import { 
  emailSchema, 
  passwordSchema, 
  strongPasswordSchema,
  usernameSchema,
  loginSchema,
  registerSchema 
} from './validations';

describe('Validation Schemas', () => {
  describe('emailSchema', () => {
    it('should accept valid email', () => {
      const result = emailSchema.safeParse('test@example.com');
      expect(result.success).toBe(true);
    });

    it('should reject invalid email', () => {
      const result = emailSchema.safeParse('invalid-email');
      expect(result.success).toBe(false);
    });

    it('should reject empty email', () => {
      const result = emailSchema.safeParse('');
      expect(result.success).toBe(false);
    });
  });

  describe('passwordSchema', () => {
    it('should accept any non-empty password', () => {
      const result = passwordSchema.safeParse('123');
      expect(result.success).toBe(true);
    });

    it('should reject empty password', () => {
      const result = passwordSchema.safeParse('');
      expect(result.success).toBe(false);
    });
  });

  describe('strongPasswordSchema', () => {
    it('should accept strong password', () => {
      const result = strongPasswordSchema.safeParse('Password123');
      expect(result.success).toBe(true);
    });

    it('should reject password without uppercase', () => {
      const result = strongPasswordSchema.safeParse('password123');
      expect(result.success).toBe(false);
    });

    it('should reject password without lowercase', () => {
      const result = strongPasswordSchema.safeParse('PASSWORD123');
      expect(result.success).toBe(false);
    });

    it('should reject password without number', () => {
      const result = strongPasswordSchema.safeParse('PasswordABC');
      expect(result.success).toBe(false);
    });

    it('should reject short password', () => {
      const result = strongPasswordSchema.safeParse('Pass1');
      expect(result.success).toBe(false);
    });
  });

  describe('usernameSchema', () => {
    it('should accept valid username', () => {
      const result = usernameSchema.safeParse('user_123');
      expect(result.success).toBe(true);
    });

    it('should reject username with special characters', () => {
      const result = usernameSchema.safeParse('user@123');
      expect(result.success).toBe(false);
    });

    it('should reject short username', () => {
      const result = usernameSchema.safeParse('ab');
      expect(result.success).toBe(false);
    });
  });

  describe('loginSchema', () => {
    it('should accept valid login data', () => {
      const result = loginSchema.safeParse({
        email: 'test@example.com',
        password: 'password123',
      });
      expect(result.success).toBe(true);
    });

    it('should reject invalid login data', () => {
      const result = loginSchema.safeParse({
        email: 'invalid',
        password: '',
      });
      expect(result.success).toBe(false);
    });
  });

  describe('registerSchema', () => {
    it('should accept valid registration data', () => {
      const result = registerSchema.safeParse({
        email: 'test@example.com',
        username: 'testuser',
        password: 'Password123',
        confirmPassword: 'Password123',
      });
      expect(result.success).toBe(true);
    });

    it('should reject mismatched passwords', () => {
      const result = registerSchema.safeParse({
        email: 'test@example.com',
        username: 'testuser',
        password: 'Password123',
        confirmPassword: 'Password456',
      });
      expect(result.success).toBe(false);
    });
  });
});
```

### 9.4 ç»„ä»¶æµ‹è¯•ç¤ºä¾‹

```typescript
// src/components/AuthModal.test.tsx (æ–°å»º)
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import userEvent from '@testing-library/user-event';
import { AuthModal } from './AuthModal';
import { AuthProvider } from '@/contexts/AuthContext';

// Mock AuthContext
const mockSignIn = vi.fn();
const mockSignUp = vi.fn();

vi.mock('@/contexts/AuthContext', () => ({
  useAuth: () => ({
    signIn: mockSignIn,
    signUp: mockSignUp,
  }),
  AuthProvider: ({ children }: { children: React.ReactNode }) => children,
}));

describe('AuthModal', () => {
  const mockOnClose = vi.fn();

  beforeEach(() => {
    vi.clearAllMocks();
  });

  it('should render login form by default', () => {
    render(<AuthModal isOpen={true} onClose={mockOnClose} />);
    
    expect(screen.getByText('æ¬¢è¿å›æ¥')).toBeInTheDocument();
    expect(screen.getByTestId('email-input')).toBeInTheDocument();
    expect(screen.getByTestId('password-input')).toBeInTheDocument();
    expect(screen.getByTestId('submit-button')).toHaveTextContent('ç™»å½•');
  });

  it('should switch to register mode', async () => {
    render(<AuthModal isOpen={true} onClose={mockOnClose} />);
    
    const switchButton = screen.getByText('ç«‹å³æ³¨å†Œ');
    await userEvent.click(switchButton);
    
    expect(screen.getByText('åˆ›å»ºè´¦æˆ·')).toBeInTheDocument();
    expect(screen.getByTestId('username-input')).toBeInTheDocument();
    expect(screen.getByTestId('confirm-password-input')).toBeInTheDocument();
  });

  it('should show validation errors for invalid email', async () => {
    render(<AuthModal isOpen={true} onClose={mockOnClose} />);
    
    const emailInput = screen.getByTestId('email-input');
    await userEvent.type(emailInput, 'invalid-email');
    await userEvent.tab(); // Trigger blur
    
    await waitFor(() => {
      expect(screen.getByTestId('email-error')).toBeInTheDocument();
    });
  });

  it('should call signIn on valid login submission', async () => {
    mockSignIn.mockResolvedValueOnce(undefined);
    
    render(<AuthModal isOpen={true} onClose={mockOnClose} />);
    
    await userEvent.type(screen.getByTestId('email-input'), 'test@example.com');
    await userEvent.type(screen.getByTestId('password-input'), 'password123');
    await userEvent.click(screen.getByTestId('submit-button'));
    
    await waitFor(() => {
      expect(mockSignIn).toHaveBeenCalledWith('test@example.com', 'password123');
    });
  });

  it('should show server error on login failure', async () => {
    mockSignIn.mockRejectedValueOnce(new Error('Invalid credentials'));
    
    render(<AuthModal isOpen={true} onClose={mockOnClose} />);
    
    await userEvent.type(screen.getByTestId('email-input'), 'test@example.com');
    await userEvent.type(screen.getByTestId('password-input'), 'wrongpassword');
    await userEvent.click(screen.getByTestId('submit-button'));
    
    await waitFor(() => {
      expect(screen.getByTestId('error-message')).toBeInTheDocument();
    });
  });

  it('should close modal on close button click', async () => {
    render(<AuthModal isOpen={true} onClose={mockOnClose} />);
    
    const closeButton = screen.getByLabelText('å…³é—­');
    await userEvent.click(closeButton);
    
    expect(mockOnClose).toHaveBeenCalled();
  });

  it('should not render when isOpen is false', () => {
    render(<AuthModal isOpen={false} onClose={mockOnClose} />);
    
    expect(screen.queryByTestId('auth-modal')).not.toBeInTheDocument();
  });
});
```

### 9.5 E2E æµ‹è¯•ä¿®å¤

```typescript
// tests/e2e/auth.spec.ts (æ›´æ–°)
import { test, expect } from '@playwright/test';

test.describe('Authentication', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/');
  });

  test('should display login modal when clicking login button', async ({ page }) => {
    await page.click('[data-testid="login-button"]');
    await expect(page.locator('[data-testid="auth-modal"]')).toBeVisible();
    await expect(page.locator('text=æ¬¢è¿å›æ¥')).toBeVisible();
  });

  test('should show validation error for invalid email', async ({ page }) => {
    await page.click('[data-testid="login-button"]');
    await page.fill('[data-testid="email-input"]', 'invalid-email');
    await page.click('[data-testid="password-input"]'); // Trigger blur
    await expect(page.locator('[data-testid="email-error"]')).toBeVisible();
  });

  test('should show error message for wrong credentials', async ({ page }) => {
    await page.click('[data-testid="login-button"]');
    await page.fill('[data-testid="email-input"]', 'wrong@example.com');
    await page.fill('[data-testid="password-input"]', 'wrongpassword');
    await page.click('[data-testid="submit-button"]');
    await expect(page.locator('[data-testid="error-message"]')).toBeVisible({ timeout: 10000 });
  });

  test('should switch between login and register modes', async ({ page }) => {
    await page.click('[data-testid="login-button"]');
    await page.click('text=ç«‹å³æ³¨å†Œ');
    await expect(page.locator('text=åˆ›å»ºè´¦æˆ·')).toBeVisible();
    await expect(page.locator('[data-testid="username-input"]')).toBeVisible();
  });

  test('should close modal when clicking close button', async ({ page }) => {
    await page.click('[data-testid="login-button"]');
    await page.click('[aria-label="å…³é—­"]');
    await expect(page.locator('[data-testid="auth-modal"]')).not.toBeVisible();
  });

  test('should close modal when clicking outside', async ({ page }) => {
    await page.click('[data-testid="login-button"]');
    await page.click('.fixed.inset-0', { position: { x: 10, y: 10 } });
    await expect(page.locator('[data-testid="auth-modal"]')).not.toBeVisible();
  });
});

test.describe('Authenticated User', () => {
  test.beforeEach(async ({ page }) => {
    // ç™»å½•
    await page.goto('/');
    await page.click('[data-testid="login-button"]');
    await page.fill('[data-testid="email-input"]', process.env.TEST_USER_EMAIL!);
    await page.fill('[data-testid="password-input"]', process.env.TEST_USER_PASSWORD!);
    await page.click('[data-testid="submit-button"]');
    await page.waitForURL('**/dashboard', { timeout: 10000 });
  });

  test('should display user menu after login', async ({ page }) => {
    await expect(page.locator('[data-testid="user-menu"]')).toBeVisible();
  });

  test('should navigate to dashboard', async ({ page }) => {
    await expect(page.locator('[data-testid="dashboard-link"]')).toBeVisible();
    await page.click('[data-testid="dashboard-link"]');
    await expect(page).toHaveURL(/.*dashboard/);
  });

  test('should display notifications button', async ({ page }) => {
    await expect(page.locator('[data-testid="notifications-button"]')).toBeVisible();
  });

  test('should open notifications panel', async ({ page }) => {
    await page.click('[data-testid="notifications-button"]');
    await expect(page.locator('[data-testid="notifications-panel"]')).toBeVisible();
  });

  test('should logout successfully', async ({ page }) => {
    await page.click('[data-testid="logout-button"]');
    await page.waitForURL('/');
    await expect(page.locator('[data-testid="login-button"]')).toBeVisible();
    // éªŒè¯ localStorage å·²æ¸…ç©º
    const storage = await page.evaluate(() => localStorage.length);
    expect(storage).toBe(0);
  });
});
```

### 9.6 Playwright é…ç½®

```typescript
// playwright.config.ts (æ›´æ–°)
import { defineConfig, devices } from '@playwright/test';
import dotenv from 'dotenv';

dotenv.config({ path: '.env.local' });

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: [
    ['html', { outputFolder: 'playwright-report' }],
    ['json', { outputFile: 'test-results/results.json' }],
  ],
  use: {
    baseURL: process.env.PLAYWRIGHT_TEST_BASE_URL || 'http://localhost:5173',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'on-first-retry',
  },
  projects: [
    {
      name: 'chromium',
      use: { ...devices['Desktop Chrome'] },
    },
    {
      name: 'firefox',
      use: { ...devices['Desktop Firefox'] },
    },
    {
      name: 'webkit',
      use: { ...devices['Desktop Safari'] },
    },
    {
      name: 'Mobile Chrome',
      use: { ...devices['Pixel 5'] },
    },
    {
      name: 'Mobile Safari',
      use: { ...devices['iPhone 12'] },
    },
  ],
  webServer: {
    command: 'pnpm dev',
    url: 'http://localhost:5173',
    reuseExistingServer: !process.env.CI,
    timeout: 120000,
  },
});
```

### 9.7 Phase 7 éªŒè¯å’Œæäº¤

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
pnpm test:run

# è¿è¡Œæµ‹è¯•è¦†ç›–ç‡
pnpm test:coverage
# ç›®æ ‡ï¼š70%+ è¦†ç›–ç‡

# è¿è¡Œ E2E æµ‹è¯•
pnpm test:e2e
# ç›®æ ‡ï¼š80%+ é€šè¿‡ç‡

# æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
open playwright-report/index.html

# æäº¤
git add -A
git commit -m "test: Phase 7 - Test coverage improvement (Vitest, Playwright)"
git push origin feat/phase7-testing
```

---

## åã€éªŒè¯æ¸…å•

### 10.1 åŠŸèƒ½éªŒè¯

| åŠŸèƒ½ | éªŒè¯æ–¹æ³• | é¢„æœŸç»“æœ |
|------|----------|----------|
| ç™»å‡ºæµç¨‹ | æ‰‹åŠ¨æµ‹è¯• + E2E | localStorage æ¸…ç©ºï¼Œé‡å®šå‘åˆ°é¦–é¡µ |
| é€šçŸ¥é¢æ¿ | æ‰‹åŠ¨æµ‹è¯• + E2E | æ‰“å¼€/å…³é—­æ­£å¸¸ï¼Œä¹è§‚æ›´æ–°ç”Ÿæ•ˆ |
| è¡¨å•éªŒè¯ | å•å…ƒæµ‹è¯• + E2E | é”™è¯¯æ¶ˆæ¯æ­£ç¡®æ˜¾ç¤º |
| ä»£ç åˆ†å‰² | Bundle åˆ†æ | å¤šä¸ª vendor chunk |
| æ‡’åŠ è½½ | Network æ ‡ç­¾ | æŒ‰éœ€åŠ è½½ JS |
| Admin Dashboard | æ‰‹åŠ¨æµ‹è¯• | ç»Ÿè®¡æ•°æ®æ­£ç¡® |
| AI Review | API æµ‹è¯• | è¿”å›è¯„å®¡ç»“æœ |
| Success Score | æ•°æ®åº“æŸ¥è¯¢ | è‡ªåŠ¨è®¡ç®—æ­£ç¡® |
| SEO | ç»“æ„åŒ–æ•°æ®æµ‹è¯• | é€šè¿‡éªŒè¯ |
| å¯è®¿é—®æ€§ | axe DevTools | æ— ä¸¥é‡é—®é¢˜ |

### 10.2 æ€§èƒ½éªŒè¯

| æŒ‡æ ‡ | å·¥å…· | ç›®æ ‡ |
|------|------|------|
| LCP | Lighthouse | < 2.5s |
| INP | Lighthouse | < 200ms |
| CLS | Lighthouse | < 0.1 |
| Performance Score | Lighthouse | â‰¥ 90 |
| Bundle Size | vite-bundle-visualizer | < 250KB |

### 10.3 æµ‹è¯•è¦†ç›–éªŒè¯

| ç±»å‹ | å·¥å…· | ç›®æ ‡ |
|------|------|------|
| å•å…ƒæµ‹è¯• | Vitest | 70%+ |
| E2E æµ‹è¯• | Playwright | 80%+ |
| è®¤è¯æµ‹è¯• | Playwright | 90%+ |
| Dashboard æµ‹è¯• | Playwright | 80%+ |

---

## åä¸€ã€é™„å½•

### A. å®Œæ•´æ–‡ä»¶æ¸…å•

```
src/
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ auth-utils.ts          # ç™»å‡ºå·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ react-query.ts         # React Query å®¢æˆ·ç«¯
â”‚   â”œâ”€â”€ sentry.ts              # Sentry é…ç½®
â”‚   â”œâ”€â”€ posthog.ts             # PostHog é…ç½®
â”‚   â”œâ”€â”€ web-vitals.ts          # Web Vitals ç›‘æ§
â”‚   â”œâ”€â”€ validations.ts         # Zod éªŒè¯ Schema
â”‚   â”œâ”€â”€ a11y.ts                # å¯è®¿é—®æ€§å·¥å…·
â”‚   â””â”€â”€ validations.test.ts    # éªŒè¯æµ‹è¯•
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ AuthModal.tsx          # é‡æ„çš„è®¤è¯æ¨¡æ€æ¡†
â”‚   â”œâ”€â”€ AuthModal.test.tsx     # è®¤è¯æ¨¡æ€æ¡†æµ‹è¯•
â”‚   â”œâ”€â”€ NotificationCenter.tsx # é‡æ„çš„é€šçŸ¥ä¸­å¿ƒ
â”‚   â”œâ”€â”€ ErrorFallback.tsx      # é”™è¯¯è¾¹ç•Œç»„ä»¶
â”‚   â”œâ”€â”€ PageLoader.tsx         # é¡µé¢åŠ è½½ç»„ä»¶
â”‚   â”œâ”€â”€ Skeleton.tsx           # éª¨æ¶å±ç»„ä»¶
â”‚   â”œâ”€â”€ OptimizedImage.tsx     # ä¼˜åŒ–å›¾ç‰‡ç»„ä»¶
â”‚   â”œâ”€â”€ SEO.tsx                # SEO ç»„ä»¶
â”‚   â””â”€â”€ SuccessScoreCard.tsx   # Success Score å±•ç¤º
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ admin/
â”‚       â””â”€â”€ Dashboard.tsx      # Admin Dashboard
â”œâ”€â”€ contexts/
â”‚   â””â”€â”€ AuthContext.tsx        # æ›´æ–°çš„è®¤è¯ä¸Šä¸‹æ–‡
â”œâ”€â”€ router.tsx                 # æ‡’åŠ è½½è·¯ç”±
â””â”€â”€ main.tsx                   # å…¥å£æ–‡ä»¶ï¼ˆå«ç›‘æ§åˆå§‹åŒ–ï¼‰

supabase/
â””â”€â”€ functions/
    â””â”€â”€ ai-review/
        â””â”€â”€ index.ts           # AI Review Edge Function

scripts/
â””â”€â”€ generate-sitemap.ts        # Sitemap ç”Ÿæˆè„šæœ¬

tests/
â”œâ”€â”€ setup.ts                   # æµ‹è¯•è®¾ç½®
â””â”€â”€ e2e/
    â”œâ”€â”€ auth.spec.ts           # è®¤è¯ E2E æµ‹è¯•
    â””â”€â”€ dashboard.spec.ts      # Dashboard E2E æµ‹è¯•

migrations/
â”œâ”€â”€ 20260108_admin_roles.sql   # ç®¡ç†å‘˜è§’è‰²è¿ç§»
â””â”€â”€ 20260108_success_score.sql # Success Score è¿ç§»

é…ç½®æ–‡ä»¶:
â”œâ”€â”€ vite.config.ts             # Vite é…ç½®ï¼ˆå«ä»£ç åˆ†å‰²ï¼‰
â”œâ”€â”€ vitest.config.ts           # Vitest é…ç½®
â”œâ”€â”€ playwright.config.ts       # Playwright é…ç½®
â””â”€â”€ .env.local                 # ç¯å¢ƒå˜é‡
```

### B. Git æäº¤å†å²

```bash
# Phase 0
chore: Phase 0 - Infrastructure setup

# Phase 1
fix: Phase 1 - P0 bug fixes (logout, notifications, form validation)

# Phase 2
feat: Phase 2 - Monitoring system (Sentry, PostHog, Web Vitals)

# Phase 3
perf: Phase 3 - Performance optimization (code splitting, lazy loading, image optimization)

# Phase 4
feat: Phase 4 - Admin Dashboard and AI Review system

# Phase 5
feat: Phase 5 - Gamification system (Success Score, Levels, Badges)

# Phase 6
feat: Phase 6 - SEO and Accessibility (Schema.org, WCAG 2.2)

# Phase 7
test: Phase 7 - Test coverage improvement (Vitest, Playwright)

# æœ€ç»ˆåˆå¹¶
git checkout main
git merge feat/comprehensive-fixes
git push origin main
```

### C. ä¾èµ–ç‰ˆæœ¬

```json
{
  "dependencies": {
    "@hookform/resolvers": "^3.3.4",
    "@sentry/react": "^7.100.0",
    "@supabase/supabase-js": "^2.87.1",
    "@tanstack/react-query": "^5.17.0",
    "date-fns": "^3.3.0",
    "framer-motion": "^11.0.0",
    "lucide-react": "^0.312.0",
    "posthog-js": "^1.100.0",
    "react": "^19.2.1",
    "react-dom": "^19.2.1",
    "react-helmet-async": "^2.0.4",
    "react-hook-form": "^7.50.0",
    "react-router-dom": "^6.22.0",
    "web-vitals": "^3.5.0",
    "zod": "^3.22.4"
  },
  "devDependencies": {
    "@playwright/test": "^1.41.0",
    "@testing-library/jest-dom": "^6.4.0",
    "@testing-library/react": "^14.2.0",
    "@testing-library/user-event": "^14.5.0",
    "rollup-plugin-visualizer": "^5.12.0",
    "sharp": "^0.33.2",
    "vite-plugin-compression": "^0.5.1",
    "vite-plugin-image-optimizer": "^1.1.7",
    "vitest": "^1.2.0"
  }
}
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0  
**ä½œè€…**: Manus AI  
**æœ€åæ›´æ–°**: 2026å¹´1æœˆ8æ—¥

